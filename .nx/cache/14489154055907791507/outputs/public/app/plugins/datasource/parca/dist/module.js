/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","react","@emotion/css","@grafana/runtime","@grafana/ui","lodash","rxjs"],((e,t,r,n,a,o,i)=>(()=>{"use strict";var s={44:(e,t,r)=>{var n=r(959),a=Symbol.for("react.element"),o=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,r){var n,l={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,n)&&!s.hasOwnProperty(n)&&(l[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===l[n]&&(l[n]=t[n]);return{$$typeof:a,type:e,key:c,ref:u,props:l,_owner:i.current}}t.jsx=l,t.jsxs=l},728:(e,t,r)=>{e.exports=r(44)},89:e=>{e.exports=r},781:t=>{t.exports=e},531:e=>{e.exports=n},7:e=>{e.exports=a},241:e=>{e.exports=o},959:e=>{e.exports=t},269:e=>{e.exports=i}},l={};function c(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={exports:{}};return s[e](r,r.exports,c),r.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{c.r(u),c.d(u,{plugin:()=>Or});var e=c(781),t=c(728),r=c(89),n=c(959),a=c.n(n),o=c(7),i=Object.defineProperty,s=Object.defineProperties,l=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,h=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,g=(e,t)=>{for(var r in t||(t={}))p.call(t,r)&&h(e,r,t[r]);if(d)for(var r of d(t))f.call(t,r)&&h(e,r,t[r]);return e};const m=({dataSourceName:e,docsLink:t,hasRequiredFields:n=!0,className:i})=>{const c=(0,o.useTheme2)(),u={container:(0,r.css)({p:{margin:0},"p + p":{marginTop:c.spacing(2)}}),text:(0,r.css)((d=g({},c.typography.body),p={color:c.colors.text.secondary,a:(0,r.css)({color:c.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})},s(d,l(p))))};var d,p;return a().createElement("div",{className:(0,r.cx)(u.container,i)},a().createElement("p",{className:u.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",a().createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),n&&a().createElement("p",{className:u.text},a().createElement("i",null,"Fields marked with * are required")))};var b=Object.defineProperty,y=Object.defineProperties,v=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,w=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,j=(e,t,r)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,x=(e,t)=>{for(var r in t||(t={}))w.call(t,r)&&j(e,r,t[r]);if(O)for(var r of O(t))C.call(t,r)&&j(e,r,t[r]);return e};const P=({children:e,title:t,description:i,isCollapsible:s=!1,isInitiallyOpen:l=!0,kind:c="section",className:u})=>{const{colors:d,typography:p,spacing:f}=(0,o.useTheme2)(),[h,g]=(0,n.useState)(!s||l),m=h?"angle-up":"angle-down",b="sub-section"===c,O=`${h?"Collapse":"Expand"} section ${t}`,w={header:(0,r.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,r.css)({margin:0}),subtitle:(0,r.css)({margin:0,fontWeight:p.fontWeightRegular}),descriptionText:(0,r.css)((C=x({marginTop:f(b?.25:.5),marginBottom:0},p.bodySmall),j={color:d.text.secondary},y(C,v(j)))),content:(0,r.css)({marginTop:f(2)})};var C,j;return a().createElement("div",{className:u},a().createElement("div",{className:w.header},"section"===c?a().createElement("h3",{className:w.title},t):a().createElement("h6",{className:w.subtitle},t),s&&a().createElement(o.IconButton,{name:m,onClick:()=>g(!h),type:"button",size:"xl","aria-label":O})),i&&a().createElement("p",{className:w.descriptionText},i),h&&a().createElement("div",{className:w.content},e))};var E=Object.defineProperty,S=Object.defineProperties,A=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,N=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,F=(e,t,r)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const I=e=>{var t,r=e,{children:n}=r,o=((e,t)=>{var r={};for(var n in e)N.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&T)for(var n of T(e))t.indexOf(n)<0&&D.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return a().createElement(P,(t=((e,t)=>{for(var r in t||(t={}))N.call(t,r)&&F(e,r,t[r]);if(T)for(var r of T(t))D.call(t,r)&&F(e,r,t[r]);return e})({},o),S(t,A({kind:"section"}))),n)};var k=Object.defineProperty,L=Object.defineProperties,R=Object.getOwnPropertyDescriptors,M=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable,W=(e,t,r)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const q=({config:e,onChange:t,description:n,urlPlaceholder:i,urlTooltip:s,urlLabel:l,className:c})=>{const u=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(e.url),d={container:(0,r.css)({maxWidth:578})};return a().createElement(a().Fragment,null,a().createElement(I,{title:"Connection",description:n,className:(0,r.cx)(d.container,c)},a().createElement(o.InlineField,{htmlFor:"connection-url",label:l||"URL",labelWidth:24,tooltip:s||a().createElement(a().Fragment,null,"Specify a complete HTTP URL",a().createElement("br",null),"(for example https://example.com:8080)"),grow:!0,disabled:e.readOnly,required:!0,invalid:!u&&!e.readOnly,error:u?"":"Please enter a valid URL",interactive:!0},a().createElement(o.Input,{id:"connection-url","aria-label":"Data source connection URL",onChange:r=>{return t((n=((e,t)=>{for(var r in t||(t={}))B.call(t,r)&&W(e,r,t[r]);if(M)for(var r of M(t))_.call(t,r)&&W(e,r,t[r]);return e})({},e),a={url:r.currentTarget.value},L(n,R(a))));var n,a},value:e.url||"",placeholder:i||"URL"}))))},J=()=>({inlineFieldNoMarginRight:(0,r.css)({marginRight:0}),inlineFieldWithSecret:(0,r.css)({'[class$="layoutChildrenWrapper"]:first-child':{flexGrow:1}})}),$=({user:e,passwordConfigured:t,userLabel:n="User",userTooltip:i="The username of the data source account",userPlaceholder:s="User",passwordLabel:l="Password",passwordTooltip:c="The password of the data source account",passwordPlaceholder:u="Password",onUserChange:d,onPasswordChange:p,onPasswordReset:f,readOnly:h})=>{const g=J(),m={lastInlineField:(0,r.css)({marginBottom:0})};return a().createElement(a().Fragment,null,a().createElement(o.InlineField,{className:g.inlineFieldNoMarginRight,label:n,labelWidth:24,tooltip:i,required:!0,htmlFor:"basic-auth-user-input",interactive:!0,grow:!0,disabled:h},a().createElement(o.Input,{id:"basic-auth-user-input",placeholder:s,value:e,onChange:e=>d(e.currentTarget.value),required:!0})),a().createElement(o.InlineField,{className:(0,r.cx)(g.inlineFieldNoMarginRight,g.inlineFieldWithSecret,m.lastInlineField),label:l,labelWidth:24,tooltip:c,required:!0,htmlFor:"basic-auth-password-input",interactive:!0,grow:!0,disabled:h},a().createElement(o.SecretInput,{id:"basic-auth-password-input",isConfigured:t,onReset:h?()=>{}:f,placeholder:u,onChange:e=>p(e.currentTarget.value),required:!0})))};var U=Object.defineProperty,z=Object.defineProperties,K=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable,G=(e,t,r)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const Y=e=>{var t,r=e,{children:n}=r,o=((e,t)=>{var r={};for(var n in e)H.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&V)for(var n of V(e))t.indexOf(n)<0&&Q.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return a().createElement(P,(t=((e,t)=>{for(var r in t||(t={}))H.call(t,r)&&G(e,r,t[r]);if(V)for(var r of V(t))Q.call(t,r)&&G(e,r,t[r]);return e})({},o),z(t,K({kind:"sub-section"}))),n)};var Z=(e=>(e.NoAuth="NoAuth",e.BasicAuth="BasicAuth",e.OAuthForward="OAuthForward",e.CrossSiteCredentials="CrossSiteCredentials",e))(Z||{}),X=Object.defineProperty,ee=Object.defineProperties,te=Object.getOwnPropertyDescriptors,re=Object.getOwnPropertySymbols,ne=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable,oe=(e,t,r)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ie=(e,t)=>{for(var r in t||(t={}))ne.call(t,r)&&oe(e,r,t[r]);if(re)for(var r of re(t))ae.call(t,r)&&oe(e,r,t[r]);return e},se=(e,t)=>ee(e,te(t));const le={[Z.BasicAuth]:{label:"Basic authentication",value:Z.BasicAuth,description:"Authenticate with your data source username and password"},[Z.CrossSiteCredentials]:{label:"Enable cross-site access control requests",value:Z.CrossSiteCredentials,description:"Allow cross-site Access-Control requests with your existing credentials and cookies. This enables the server to authenticate the user and perform authorized requests on their behalf on other domains."},[Z.OAuthForward]:{label:"Forward OAuth Identity",value:Z.OAuthForward,description:"Forward the OAuth access token (and if available: the OIDC ID token) of the user querying to the data source"},[Z.NoAuth]:{label:"No Authentication",value:Z.NoAuth,description:"Data source is available without authentication"}},ce=({selectedMethod:e,mostCommonMethod:t,visibleMethods:i,extendedDefaultOptions:s,customMethods:l,onAuthMethodSelect:c,basicAuth:u,readOnly:d})=>{var p,f,h,g;const[m,b]=(0,n.useState)(!1),{colors:y,spacing:v}=(0,o.useTheme2)(),O=(0,n.useMemo)((()=>{var e;return null!=i?i:[Z.BasicAuth,Z.OAuthForward,Z.NoAuth,...null!=(e=null==l?void 0:l.map((e=>e.id)))?e:[]]}),[l,i]),w=O.length>1,C=(0,n.useMemo)((()=>{var e;const r=null!=(e=null==l?void 0:l.reduce(((e,t)=>(e[t.id]={label:t.label,value:t.id,description:t.description},e)),{}))?e:{},n={};let a;for(a in le)s&&s[a]?n[a]=ie(ie({},le[a]),s[a]):n[a]=le[a];const o=ie(ie({},r),n);return O.filter((e=>Boolean(o[e]))).map((e=>{const r=o[e];return e===t&&w?se(ie({},r),{label:`${r.label} (most common)`}):r}))}),[O,l,s,t,w]);let j=e;w?e===Z.NoAuth&&t&&!m&&(j=t):j=O[0];let x=null;j===Z.BasicAuth&&u?x=a().createElement($,se(ie({},u),{readOnly:d})):j.startsWith("custom-")&&(x=null!=(f=null==(p=null==l?void 0:l.find((e=>e.id===j)))?void 0:p.component)?f:null);const P=w?"Authentication methods":null!=(h=C[0].label)?h:"",E=w?"Choose an authentication method to access the data source":null!=(g=C[0].description)?g:"",S={authMethods:(0,r.css)(ie({marginTop:v(2.5)},w&&{padding:v(2),border:`1px solid ${y.border.weak}`})),selectedMethodFields:(0,r.css)({marginTop:v(1.5)})};return a().createElement(Y,{title:P,description:E},a().createElement("div",{className:S.authMethods},w&&a().createElement(o.Select,{options:C,value:j,onChange:e=>{b(!0),c(e.value)},disabled:d}),x&&a().createElement("div",{className:S.selectedMethodFields},x)))},ue=({children:e,enabled:t,label:n,tooltipText:i,onToggle:s,readOnly:l})=>{const{colors:c,spacing:u}=(0,o.useTheme2)(),d={container:(0,r.css)({marginTop:3}),checkboxContainer:(0,r.css)({display:"flex",alignItems:"center"}),infoIcon:(0,r.css)({marginTop:-2,marginLeft:5,color:c.text.secondary}),content:(0,r.css)({margin:u(1,0,2,3)})};return a().createElement("div",{className:d.container},a().createElement("div",{className:d.checkboxContainer},a().createElement(o.Checkbox,{value:t,label:n,onChange:()=>s(!t),disabled:l}),a().createElement(o.Tooltip,{placement:"top",content:i,interactive:!0},a().createElement(o.Icon,{name:"info-circle",className:d.infoIcon,size:"sm"}))),t&&e&&a().createElement("div",{className:d.content},e))},de=({enabled:e,certificateConfigured:t,onToggle:n,onCertificateChange:i,onCertificateReset:s,tooltips:l,readOnly:c})=>{var u;const d=J();return a().createElement(ue,{enabled:e,label:"Add self-signed certificate",tooltipText:"Add your own Certificate Authority (CA) certificate on top of one generated by the certificate authorities for additional security measures",onToggle:e=>n(e),readOnly:c},a().createElement(o.InlineField,{label:"CA Certificate",labelWidth:24,tooltip:null!=(u=null==l?void 0:l.certificateLabel)?u:"Your self-signed certificate",required:!0,htmlFor:"self-signed-certificate-input",interactive:!0,grow:!0,className:(0,r.cx)(d.inlineFieldNoMarginRight,d.inlineFieldWithSecret),disabled:c},a().createElement(o.SecretTextArea,{id:"self-signed-certificate-input",isConfigured:t,onChange:e=>i(e.currentTarget.value),onReset:c?()=>{}:s,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})))},pe=({enabled:e,serverName:t,clientCertificateConfigured:n,clientKeyConfigured:i,onToggle:s,onServerNameChange:l,onClientCertificateChange:c,onClientKeyChange:u,onClientCertificateReset:d,onClientKeyReset:p,tooltips:f,readOnly:h})=>{var g,m,b;const y=J();return a().createElement(ue,{enabled:e,label:"TLS Client Authentication",tooltipText:"Validate using TLS client authentication, in which the server authenticates the client",onToggle:e=>s(e),readOnly:h},a().createElement(o.InlineField,{label:"ServerName",labelWidth:24,tooltip:null!=(g=null==f?void 0:f.serverNameLabel)?g:"A Servername is used to verify the hostname on the returned certificate",required:!0,htmlFor:"client-auth-servername-input",interactive:!0,grow:!0,className:y.inlineFieldNoMarginRight,disabled:h},a().createElement(o.Input,{id:"client-auth-servername-input",placeholder:"domain.example.com",value:t,onChange:e=>l(e.currentTarget.value),required:!0})),a().createElement(o.InlineField,{label:"Client Certificate",labelWidth:24,tooltip:null!=(m=null==f?void 0:f.certificateLabel)?m:"The client certificate can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-certificate-input",interactive:!0,grow:!0,className:(0,r.cx)(y.inlineFieldNoMarginRight,y.inlineFieldWithSecret),disabled:h},a().createElement(o.SecretTextArea,{id:"client-auth-client-certificate-input",isConfigured:n,onChange:e=>c(e.currentTarget.value),onReset:h?()=>{}:d,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})),a().createElement(o.InlineField,{label:"Client Key",labelWidth:24,tooltip:null!=(b=null==f?void 0:f.keyLabel)?b:"The client key can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-key-input",interactive:!0,grow:!0,className:(0,r.cx)(y.inlineFieldNoMarginRight,y.inlineFieldWithSecret),disabled:h},a().createElement(o.SecretTextArea,{id:"client-auth-client-key-input",isConfigured:i,onChange:e=>u(e.currentTarget.value),onReset:h?()=>{}:p,placeholder:"Begins with --- RSA PRIVATE KEY CERTIFICATE ---",rows:6,required:!0})))},fe=({enabled:e,onToggle:t,readOnly:r})=>a().createElement(ue,{enabled:e,label:"Skip TLS certificate validation",tooltipText:"Skipping TLS certificate validation is not recommended unless absolutely necessary or for testing",onToggle:e=>t(e),readOnly:r});var he=Object.defineProperty,ge=Object.defineProperties,me=Object.getOwnPropertyDescriptors,be=Object.getOwnPropertySymbols,ye=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable,Oe=(e,t,r)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,we=(e,t)=>{for(var r in t||(t={}))ye.call(t,r)&&Oe(e,r,t[r]);if(be)for(var r of be(t))ve.call(t,r)&&Oe(e,r,t[r]);return e},Ce=(e,t)=>ge(e,me(t));const je=({selfSignedCertificate:e,TLSClientAuth:t,skipTLSVerification:n,readOnly:i})=>{const{spacing:s}=(0,o.useTheme2)(),l={container:(0,r.css)({marginTop:s(3)})};return a().createElement(Y,{className:l.container,title:"TLS settings",description:"Additional security measures that can be applied on top of authentication"},a().createElement(de,Ce(we({},e),{readOnly:i})),a().createElement(pe,Ce(we({},t),{readOnly:i})),a().createElement(fe,Ce(we({},n),{readOnly:i})))};var xe=Object.defineProperty,Pe=Object.defineProperties,Ee=Object.getOwnPropertyDescriptors,Se=Object.getOwnPropertySymbols,Ae=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable,Ne=(e,t,r)=>t in e?xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,De=(e,t)=>{for(var r in t||(t={}))Ae.call(t,r)&&Ne(e,r,t[r]);if(Se)for(var r of Se(t))Te.call(t,r)&&Ne(e,r,t[r]);return e},Fe=(e,t)=>Pe(e,Ee(t));const Ie=({header:e,onChange:t,onBlur:n,onDelete:i,readOnly:s})=>{const{spacing:l}=(0,o.useTheme2)(),c=J(),u={container:(0,r.css)({alignItems:"center"}),input:(0,r.css)({minWidth:"100%"}),headerNameField:(0,r.css)({width:"40%",marginRight:0,paddingRight:l(1)}),headerValueField:(0,r.css)({width:"45%",marginRight:0}),removeHeaderBtn:(0,r.css)({margin:"0 0 3px 10px"})};return a().createElement(a().Fragment,null,a().createElement(o.InlineFieldRow,{className:u.container},a().createElement(o.InlineField,{label:"Header",labelWidth:9,grow:!0,className:u.headerNameField,htmlFor:`custom-header-${e.id}-name-input`,disabled:s},a().createElement(o.Input,{id:`custom-header-${e.id}-name-input`,placeholder:"X-Custom-Header",value:e.name,width:12,onChange:r=>t(Fe(De({},e),{name:r.currentTarget.value})),onBlur:n,className:u.input})),a().createElement(o.InlineField,{label:"Value",labelWidth:9,grow:!0,className:(0,r.cx)(c.inlineFieldWithSecret,u.headerValueField),htmlFor:`custom-header-${e.id}-value-input`,disabled:s},a().createElement(o.SecretInput,{id:`custom-header-${e.id}-value-input`,isConfigured:e.configured,placeholder:"Header value",value:e.value,width:12,onChange:r=>t(Fe(De({},e),{value:r.currentTarget.value})),onReset:s?()=>{}:()=>t(Fe(De({},e),{configured:!1,value:""})),onBlur:n,className:u.input})),a().createElement(o.IconButton,{name:"trash-alt",tooltip:"Remove header",tooltipPlacement:"top",className:u.removeHeaderBtn,onClick:i,type:"button",disabled:s})))};var ke=Object.defineProperty,Le=Object.defineProperties,Re=Object.getOwnPropertyDescriptors,Me=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable,We=(e,t,r)=>t in e?ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,qe=(e,t)=>{for(var r in t||(t={}))Be.call(t,r)&&We(e,r,t[r]);if(Me)for(var r of Me(t))_e.call(t,r)&&We(e,r,t[r]);return e},Je=(e,t)=>Le(e,Re(t));const $e=({headers:e,onChange:t,readOnly:i})=>{const{spacing:s}=(0,o.useTheme2)(),[l,c]=(0,n.useState)(e.map((e=>Je(qe({},e),{id:Ue(),value:""}))));(0,n.useEffect)((()=>{c((t=>{let r=!1;const n=t.map((t=>{var n;const a=null==(n=e.find((e=>e.name===t.name)))?void 0:n.configured;return void 0!==a&&t.configured!==a?(r=!0,Je(qe({},t),{configured:a})):t}));return r?n:t}))}),[e]);const u=()=>{t(l.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))},d={container:(0,r.css)({marginTop:s(3)}),addHeaderButton:(0,r.css)({marginTop:s(1.5)})};return a().createElement("div",{className:d.container},a().createElement(Y,{title:"HTTP headers",description:"Pass along additional context and metadata about the request/response",isCollapsible:!0,isInitiallyOpen:l.length>0},a().createElement("div",null,l.map((e=>a().createElement(Ie,{key:e.id,header:e,onChange:e=>((e,t)=>{c(l.map((r=>r.id===e?qe({},t):r)))})(e.id,e),onDelete:()=>(e=>{const r=l.findIndex((t=>t.id===e));if(-1===r)return;const n=[...l];n.splice(r,1),c(n),t(n.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))})(e.id),onBlur:u,readOnly:i})))),a().createElement("div",{className:d.addHeaderButton},a().createElement(o.Button,{icon:"plus",variant:"secondary",fill:"outline",onClick:()=>{c([...l,{id:Ue(),name:"",value:"",configured:!1}])},disabled:i},0===l.length?"Add header":"Add another header"))))};function Ue(){return Math.random().toString(16).slice(2)}var ze=Object.defineProperty,Ke=Object.defineProperties,Ve=Object.getOwnPropertyDescriptors,He=Object.getOwnPropertySymbols,Qe=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable,Ye=(e,t,r)=>t in e?ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ze=(e,t)=>{for(var r in t||(t={}))Qe.call(t,r)&&Ye(e,r,t[r]);if(He)for(var r of He(t))Ge.call(t,r)&&Ye(e,r,t[r]);return e},Xe=(e,t)=>Ke(e,Ve(t));const et=({selectedMethod:e,mostCommonMethod:t,visibleMethods:n,extendedDefaultOptions:o,customMethods:i,onAuthMethodSelect:s,basicAuth:l,TLS:c,customHeaders:u,readOnly:d=!1})=>{const p={container:(0,r.css)({maxWidth:578})};return a().createElement("div",{className:p.container},a().createElement(I,{title:"Authentication"},a().createElement(ce,{selectedMethod:e,mostCommonMethod:t,customMethods:i,visibleMethods:n,extendedDefaultOptions:o,onAuthMethodSelect:s,basicAuth:l,readOnly:d}),c&&a().createElement(je,Xe(Ze({},c),{readOnly:d})),u&&a().createElement($e,Xe(Ze({},u),{readOnly:d}))))};var tt=Object.defineProperty,rt=Object.defineProperties,nt=Object.getOwnPropertyDescriptors,at=Object.getOwnPropertySymbols,ot=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable,st=(e,t,r)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,lt=(e,t)=>{for(var r in t||(t={}))ot.call(t,r)&&st(e,r,t[r]);if(at)for(var r of at(t))it.call(t,r)&&st(e,r,t[r]);return e},ct=(e,t)=>rt(e,nt(t));const ut="httpHeaderName",dt="httpHeaderValue";function pt({config:e,onChange:t}){return{selectedMethod:ft(e),onAuthMethodSelect:ht(e,t),basicAuth:gt(e,t),TLS:mt(e,t),customHeaders:bt(e,t),readOnly:e.readOnly}}function ft(e){return e.basicAuth?Z.BasicAuth:e.withCredentials?Z.CrossSiteCredentials:e.jsonData.oauthPassThru?Z.OAuthForward:Z.NoAuth}function ht(e,t){return r=>{t(ct(lt({},e),{basicAuth:r===Z.BasicAuth,withCredentials:r===Z.CrossSiteCredentials,jsonData:ct(lt({},e.jsonData),{oauthPassThru:r===Z.OAuthForward})}))}}function gt(e,t){return{user:e.basicAuthUser,passwordConfigured:e.secureJsonFields.basicAuthPassword,onUserChange:r=>t(ct(lt({},e),{basicAuthUser:r})),onPasswordChange:r=>t(ct(lt({},e),{secureJsonData:ct(lt({},e.secureJsonData),{basicAuthPassword:r})})),onPasswordReset:()=>t(ct(lt({},e),{secureJsonData:ct(lt({},e.secureJsonData),{basicAuthPassword:""}),secureJsonFields:ct(lt({},e.secureJsonFields),{basicAuthPassword:!1})}))}}function mt(e,t){return{selfSignedCertificate:{enabled:Boolean(e.jsonData.tlsAuthWithCACert),certificateConfigured:e.secureJsonFields.tlsCACert,onToggle:r=>t(ct(lt({},e),r?{jsonData:ct(lt({},e.jsonData),{tlsAuthWithCACert:r})}:{jsonData:ct(lt({},e.jsonData),{tlsAuthWithCACert:r}),secureJsonData:ct(lt({},e.secureJsonData),{tlsCACert:""}),secureJsonFields:ct(lt({},e.secureJsonFields),{tlsCACert:!1})})),onCertificateChange:r=>t(ct(lt({},e),{secureJsonData:ct(lt({},e.secureJsonData),{tlsCACert:r})})),onCertificateReset:()=>t(ct(lt({},e),{secureJsonData:ct(lt({},e.secureJsonData),{tlsCACert:""}),secureJsonFields:ct(lt({},e.secureJsonFields),{tlsCACert:!1})}))},TLSClientAuth:{enabled:e.jsonData.tlsAuth,serverName:e.jsonData.serverName,clientCertificateConfigured:e.secureJsonFields.tlsClientCert,clientKeyConfigured:e.secureJsonFields.tlsClientKey,onToggle:r=>t(ct(lt({},e),r?{jsonData:ct(lt({},e.jsonData),{tlsAuth:r})}:{jsonData:ct(lt({},e.jsonData),{tlsAuth:r,serverName:""}),secureJsonData:ct(lt({},e.secureJsonData),{tlsClientCert:"",tlsClientKey:""}),secureJsonFields:ct(lt({},e.secureJsonFields),{tlsClientCert:!1,tlsClientKey:!1})})),onServerNameChange:r=>t(ct(lt({},e),{jsonData:ct(lt({},e.jsonData),{serverName:r})})),onClientCertificateChange:r=>t(ct(lt({},e),{secureJsonData:ct(lt({},e.secureJsonData),{tlsClientCert:r})})),onClientCertificateReset:()=>t(ct(lt({},e),{secureJsonData:ct(lt({},e.secureJsonData),{tlsClientCert:""}),secureJsonFields:ct(lt({},e.secureJsonFields),{tlsClientCert:!1})})),onClientKeyChange:r=>t(ct(lt({},e),{secureJsonData:ct(lt({},e.secureJsonData),{tlsClientKey:r})})),onClientKeyReset:()=>t(ct(lt({},e),{secureJsonData:ct(lt({},e.secureJsonData),{tlsClientKey:""}),secureJsonFields:ct(lt({},e.secureJsonFields),{tlsClientKey:!1})}))},skipTLSVerification:{enabled:e.jsonData.tlsSkipVerify,onToggle:r=>t(ct(lt({},e),{jsonData:ct(lt({},e.jsonData),{tlsSkipVerify:r})}))}}}function bt(e,t){return{headers:Object.keys(e.jsonData).filter((e=>e.startsWith(ut))).sort().map((t=>{var r;const n=t.slice(ut.length);return{name:e.jsonData[t],configured:null!=(r=e.secureJsonFields[`${dt}${n}`])&&r}})),onChange:r=>{const n=Object.fromEntries(Object.entries(e.jsonData).filter((([e])=>!e.startsWith(ut)))),a=Object.fromEntries(Object.entries(e.secureJsonData||{}).filter((([e])=>!e.startsWith(dt)))),o=Object.fromEntries(Object.entries(e.secureJsonFields).filter((([e])=>!e.startsWith(dt))));r.forEach(((e,t)=>{n[`${ut}${t+1}`]=e.name,e.configured?o[`${dt}${t+1}`]=!0:a[`${dt}${t+1}`]=e.value})),t(ct(lt({},e),{jsonData:n,secureJsonData:a,secureJsonFields:o}))}}}var yt=Object.defineProperty,vt=Object.defineProperties,Ot=Object.getOwnPropertyDescriptors,wt=Object.getOwnPropertySymbols,Ct=Object.prototype.hasOwnProperty,jt=Object.prototype.propertyIsEnumerable,xt=(e,t,r)=>t in e?yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Pt=(e,t)=>{for(var r in t||(t={}))Ct.call(t,r)&&xt(e,r,t[r]);if(wt)for(var r of wt(t))jt.call(t,r)&&xt(e,r,t[r]);return e},Et=(e,t)=>vt(e,Ot(t));const St=({config:e,onChange:t,className:n})=>{const i={container:(0,r.css)({maxWidth:578})};return a().createElement(Y,{title:"Advanced HTTP settings",className:(0,r.cx)(i.container,n)},a().createElement(o.InlineField,{htmlFor:"advanced-http-cookies",label:"Allowed cookies",labelWidth:24,tooltip:"Grafana proxy deletes forwarded cookies by default. Specify cookies by name that should be forwarded to the data source.",disabled:e.readOnly,grow:!0},a().createElement(o.TagsInput,{id:"advanced-http-cookies",placeholder:"New cookie (hit enter to add)",tags:e.jsonData.keepCookies,onChange:r=>{t(Et(Pt({},e),{jsonData:Et(Pt({},e.jsonData),{keepCookies:r})}))}})),a().createElement(o.InlineField,{htmlFor:"advanced-http-timeout",label:"Timeout",labelWidth:24,tooltip:"HTTP request timeout in seconds",disabled:e.readOnly,grow:!0},a().createElement(o.Input,{id:"advanced-http-timeout",type:"number",min:0,placeholder:"Timeout in seconds","aria-label":"Timeout in seconds",value:e.jsonData.timeout,onChange:r=>{t(Et(Pt({},e),{jsonData:Et(Pt({},e.jsonData),{timeout:parseInt(r.currentTarget.value,10)})}))}})))};var At=c(531);function Tt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Tt(e,t,r[t])}))}return e}const Dt=e=>({container:(0,r.css)({marginBottom:e.spacing(2),maxWidth:"900px"})});var Ft=c(241);const It=function(e){var t;t=function(){e()},(0,n.useEffect)(t,[])};function kt(e){const r=(0,o.useStyles2)(Lt,e);return(0,t.jsx)("div",{className:r.root,children:e.children})}const Lt=(e,t)=>{var n,a,o;return{root:(0,r.css)({display:"flex",flexDirection:null!==(n=t.direction)&&void 0!==n?n:"row",flexWrap:null===(a=t.wrap)||void 0===a||a?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!==(o=t.gap)&&void 0!==o?o:2),flexGrow:t.flexGrow})}};function Rt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Rt(e,t,r[t])}))}return e}const Bt=({children:e,stackProps:r})=>{const n=(0,o.useStyles2)(_t);return(0,t.jsx)("div",{className:n.root,children:(0,t.jsx)(kt,(a=Mt({gap:2},r),i={children:e},i=null!=i?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(i)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(i,e))})),a))});var a,i},_t=e=>({root:(0,r.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.radius.default})}),Wt=({children:e})=>(0,t.jsx)(kt,{gap:.5,direction:"column",children:e}),qt={id:"parca",extensions:[".parca"],aliases:["parca"],mimetypes:[],def:{language:{ignoreCase:!1,defaultToken:"",tokenPostfix:".fireql",keywords:[],operators:[],symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,integersuffix:/(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,floatsuffix:/[fFlL]?/,tokenizer:{root:[[/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,"tag"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/\d+/,"number"],[/\d*\d+[eE]([\-+]?\d+)?(@floatsuffix)/,"number.float"],[/\d*\.\d+([eE][\-+]?\d+)?(@floatsuffix)/,"number.float"],[/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/,"number.hex"],[/0[0-7']*[0-7](@integersuffix)/,"number.octal"],[/0[bB][0-1']*[0-1](@integersuffix)/,"number.binary"],[/\d[\d']*\d(@integersuffix)/,"number"],[/\d(@integersuffix)/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],clauses:[[/[^(,)]/,"tag"],[/\)/,"identifier","@pop"]],whitespace:[[/[ \t\r\n]+/,"white"]]}},languageConfiguration:{wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,brackets:[["{","}"]],autoClosingPairs:[{open:"{",close:"}"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}}}};function Jt(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function $t(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Jt(o,n,a,i,s,"next",e)}function s(e){Jt(o,n,a,i,s,"throw",e)}i(void 0)}))}}function Ut(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class zt{init(){var e=this;return $t((function*(){const t=yield e.datasource.getLabelNames();e.labels=t.reduce(((e,t)=>(e[t]=[],e)),{})}))()}provideCompletionItems(e,t){var r;if((null===(r=this.editor.getModel())||void 0===r?void 0:r.id)!==e.id)return{suggestions:[]};const{range:n,offset:a}=function(e,t,r){const n=t.getWordAtPosition(r),a=null!=n?e.Range.lift({startLineNumber:r.lineNumber,endLineNumber:r.lineNumber,startColumn:n.startColumn,endColumn:n.endColumn}):e.Range.fromPositions(r),o={column:r.column,lineNumber:r.lineNumber};return{offset:t.getOffsetAt(o),range:a}}(this.monaco,e,t),o=function(e,t){if(""===e)return{type:"EMPTY"};const r=e.matchAll(Qt),n=Array.from(r).reduce(((e,t)=>{const[r,n,a]=t[1];return e.push({name:n,value:a}),e}),[]),a=e.substring(0,t).match(Gt);if(a)return{type:"IN_LABEL_VALUE",labelName:a[1],betweenQuotes:!!a[2],otherLabels:n};return e.substring(0,t).match(Yt)?{type:"IN_LABEL_NAME",otherLabels:n}:{type:"UNKNOWN"}}(e.getValue(),a);return this.getCompletions(o).then((e=>{const t=e.length.toString().length;return{suggestions:e.map(((e,r)=>({kind:Kt(e.type,this.monaco),label:e.label,insertText:e.insertText,sortText:r.toString().padStart(t,"0"),range:n})))}}))}getCompletions(e){var t=this;return $t((function*(){if(!Object.keys(t.labels).length)return[];switch(e.type){case"UNKNOWN":return[];case"EMPTY":return Object.keys(t.labels).map((e=>({label:e,insertText:`{${e}="`,type:"LABEL_NAME"})));case"IN_LABEL_NAME":return Object.keys(t.labels).map((e=>({label:e,insertText:e,type:"LABEL_NAME"})));case"IN_LABEL_VALUE":let r=[];return t.labels[e.labelName].length?r=t.labels[e.labelName]:(r=yield t.datasource.getLabelValues(e.labelName),t.labels[e.labelName]=r),r.map((t=>({label:t,insertText:e.betweenQuotes?t:`"${t}"`,type:"LABEL_VALUE"})));default:throw new Error(`Unexpected situation ${e}`)}}))()}constructor(e,t,r){Ut(this,"datasource",void 0),Ut(this,"monaco",void 0),Ut(this,"editor",void 0),Ut(this,"triggerCharacters",void 0),Ut(this,"labels",void 0),this.datasource=e,this.monaco=t,this.editor=r,this.triggerCharacters=["{",",","[","(","=","~"," ",'"'],this.labels={}}}function Kt(e,t){switch(e){case"LABEL_NAME":return t.languages.CompletionItemKind.Enum;case"LABEL_VALUE":return t.languages.CompletionItemKind.EnumMember;default:throw new Error(`Unexpected CompletionType: ${e}`)}}const Vt=/[a-zA-Z_][a-zA-Z0-9_]*/,Ht=/[^"]*/,Qt=new RegExp(`(${Vt.source})="(${Ht.source})"`,"g"),Gt=new RegExp(`(${Vt.source})=("?)${Ht.source}$`),Yt=new RegExp(/[{,]\s*[a-zA-Z0-9_]*$/);function Zt(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Xt(e){const r=function(e){const t=(0,n.useRef)(null);return(0,n.useEffect)((()=>()=>{var e;null===(e=t.current)||void 0===e||e.call(t)}),[]),r=function*(r,n){const a=new zt(e,n,r);yield a.init();const{dispose:o}=n.languages.registerCompletionItemProvider(rr,a);t.current=o},a=function(){var e=this,t=arguments;return new Promise((function(n,a){var o=r.apply(e,t);function i(e){Zt(o,n,a,i,s,"next",e)}function s(e){Zt(o,n,a,i,s,"throw",e)}i(void 0)}))},function(e,t){return a.apply(this,arguments)};var r,a}(e.datasource),a=(0,o.useStyles2)(ar),i=(l=e.onRunQuery,(c=(0,n.useRef)(l)).current=l,c),s=(0,n.useRef)(null);var l,c;return(0,t.jsx)("div",{className:a.wrapper,ref:s,children:(0,t.jsx)(o.CodeEditor,{value:e.value,language:rr,onBlur:e.onChange,containerStyles:a.queryField,monacoOptions:{folding:!1,fontSize:14,lineNumbers:"off",overviewRulerLanes:0,renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,wordWrap:"on",padding:{top:5,bottom:6}},onBeforeEditorMount:nr,onEditorDidMount:(e,t)=>{r(e,t);const n=()=>{const t=s.current;if(null!==t){const r=e.getContentHeight();t.style.height=`${r+er}px`,t.style.width="100%";const n=t.clientWidth;e.layout({width:n,height:r})}};e.onDidContentSizeChange(n),n(),e.addCommand(t.KeyMod.Shift|t.KeyCode.Enter,(()=>{i.current(e.getValue())}))}})})}const er=2;let tr=!1;const rr="parca";function nr(e){if(!1===tr){tr=!0;const{aliases:t,extensions:r,mimetypes:n,def:a}=qt;e.languages.register({id:rr,aliases:t,extensions:r,mimetypes:n}),e.languages.setMonarchTokensProvider(rr,a.language),e.languages.setLanguageConfiguration(rr,a.languageConfiguration)}}const ar=()=>({queryField:r.css`
      flex: 1;
      // Not exactly sure but without this the editor doe not shrink after resizing (so you can make it bigger but not
      // smaller). At the same time this does not actually make the editor 100px because it has flex 1 so I assume
      // this should sort of act as a flex-basis (but flex-basis does not work for this). So yeah CSS magic.
      width: 100px;
    `,wrapper:r.css`
      display: flex;
      flex: 1;
      border: 1px solid rgba(36, 41, 46, 0.3);
      border-radius: 2px;
    `});var or=function(e,t){return"boolean"==typeof t?t:!e};const ir=[{value:"metrics",label:"Metric",description:"Return aggregated metrics"},{value:"profile",label:"Profile",description:"Return profile"},{value:"both",label:"Both",description:"Return both metric and profile data"}];function sr({query:a,onQueryTypeChange:i,app:s}){const[l,c]=(f=!1,(0,n.useReducer)(or,f)),u=(0,o.useStyles2)(lr),d=function(t){return t===e.CoreApp.Explore?ir:ir.filter((e=>"both"!==e.value))}(s),p=(0,o.useStyles2)(o.clearButtonStyles);var f;return(0,t.jsxs)(kt,{gap:0,direction:"column",children:[(0,t.jsxs)(o.Button,{className:(0,r.cx)(u.header,p),onClick:c,title:"Click to edit options",children:[(0,t.jsx)("div",{className:u.toggle,children:(0,t.jsx)(o.Icon,{name:l?"angle-down":"angle-right"})}),(0,t.jsx)("h6",{className:u.title,children:"Options"}),!l&&(0,t.jsx)("div",{className:u.description,children:(0,t.jsxs)("span",{children:["Type: ",a.queryType]})})]}),l&&(0,t.jsx)("div",{className:u.body,children:(0,t.jsx)(o.Field,{label:"Query Type",children:(0,t.jsx)(o.RadioButtonGroup,{options:d,value:a.queryType,onChange:i})})})]})}const lr=e=>({switchLabel:(0,r.css)({color:e.colors.text.secondary,cursor:"pointer",fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.primary}}),header:(0,r.css)({display:"flex",cursor:"pointer",alignItems:"baseline",color:e.colors.text.primary,"&:hover":{background:e.colors.emphasize(e.colors.background.primary,.03)}}),title:(0,r.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,r.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,r.css)({display:"flex",paddingTop:e.spacing(2),gap:e.spacing(2),flexWrap:"wrap"}),toggle:(0,r.css)({color:e.colors.text.secondary,marginRight:`${e.spacing(1)}`})});function cr(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function ur(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){cr(o,n,a,i,s,"next",e)}function s(e){cr(o,n,a,i,s,"throw",e)}i(void 0)}))}}function dr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){dr(e,t,r[t])}))}return e}function fr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const hr=fr(pr({},{labelSelector:"{}"}),{queryType:"both"});var gr=c(269);function mr(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function br(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){mr(o,n,a,i,s,"next",e)}function s(e){mr(o,n,a,i,s,"throw",e)}i(void 0)}))}}function yr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class vr extends At.DataSourceWithBackend{query(e){return e.targets.every((e=>e.profileTypeId))?super.query(e):(0,gr.of)({data:[]})}applyTemplateVariables(e,t){var r,n,a;return n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){yr(e,t,r[t])}))}return e}({},e),a=null!=(a={labelSelector:this.templateSrv.replace(null!==(r=e.labelSelector)&&void 0!==r?r:"",t)})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))})),n}getProfileTypes(){var e=this,t=()=>super.getResource;return br((function*(){return yield t().call(e,"profileTypes")}))()}getLabelNames(){var e=this,t=()=>super.getResource;return br((function*(){return yield t().call(e,"labelNames")}))()}getLabelValues(e){var t=this,r=()=>super.getResource;return br((function*(){return yield r().call(t,"labelValues",{label:e})}))()}constructor(e,t=(0,At.getTemplateSrv)()){super(e),yr(this,"templateSrv",void 0),this.templateSrv=t}}const Or=new e.DataSourcePlugin(vr).setConfigEditor((e=>{const{options:r,onOptionsChange:n}=e,a=(0,o.useStyles2)(Dt);return(0,t.jsxs)("div",{className:a.container,children:[(0,t.jsx)(m,{dataSourceName:"Parca",docsLink:"https://grafana.com/docs/grafana/latest/datasources/parca",hasRequiredFields:!1}),(0,t.jsx)(o.Divider,{spacing:4}),(0,t.jsx)(q,{config:r,onChange:n,urlPlaceholder:"http://localhost:7070"}),(0,t.jsx)(o.Divider,{spacing:4}),(0,t.jsx)(et,Nt({},pt({config:r,onChange:n}))),(0,t.jsx)(o.Divider,{spacing:4}),(0,t.jsx)(I,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!1,children:(0,t.jsxs)(o.Stack,{gap:5,direction:"column",children:[(0,t.jsx)(St,{config:r,onChange:n}),At.config.secureSocksDSProxyEnabled&&(0,t.jsx)(o.SecureSocksProxySettings,{options:r,onOptionsChange:n})]})})]})})).setQueryEditor((function(r){const[a,i]=(0,n.useState)([]);It(ur((function*(){const e=yield r.datasource.getProfileTypes();i(e)})));const s=(0,n.useMemo)((()=>{let e=new Map;for(let n of a){var t,r;e.has(n.name)||e.set(n.name,{label:n.name,value:n.ID,children:[]}),null===(r=e.get(n.name))||void 0===r||null===(t=r.children)||void 0===t||t.push({label:n.sample_type,value:n.ID})}return Array.from(e.values())}),[a]),l=(0,n.useMemo)((()=>{if(!a)return"Loading";const e=a.find((e=>e.ID===r.query.profileTypeId));return e?e.name+" - "+e.sample_type:"Select a profile type"}),[r.query.profileTypeId,a]);let c=function(t,r){let n=(0,Ft.defaults)(t,hr);return r!==e.CoreApp.Explore&&"both"===n.queryType&&(n.queryType="profile"),n}(r.query,r.app);return(0,t.jsxs)(Wt,{children:[(0,t.jsxs)(Bt,{stackProps:{wrap:!1,gap:1},children:[(0,t.jsx)(o.ButtonCascader,{onChange:function(e,t){if(0===t.length)return;const n=t[t.length-1].value;if("string"!=typeof n)throw new Error("id is not string");r.onChange(fr(pr({},r.query),{profileTypeId:n}))},options:s,buttonProps:{variant:"secondary"},children:l}),(0,t.jsx)(Xt,{value:c.labelSelector,onChange:function(e){r.onChange(fr(pr({},r.query),{labelSelector:e}))},datasource:r.datasource,onRunQuery:function(e){r.onChange(fr(pr({},r.query),{labelSelector:e})),r.onRunQuery()}})]}),(0,t.jsx)(Bt,{children:(0,t.jsx)(sr,{query:c,onQueryTypeChange:e=>{r.onChange(fr(pr({},c),{queryType:e}))},app:r.app})})]})}))})(),u})()));
//# sourceMappingURL=module.js.map