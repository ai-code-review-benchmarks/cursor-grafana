/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","react","@emotion/css","@grafana/runtime","@grafana/ui","lodash","prismjs","rxjs"],((e,t,r,n,o,a,l,i)=>(()=>{"use strict";var s={513:e=>{e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,o,a;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(o=n;0!=o--;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(a=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(o=n;0!=o--;)if(!Object.prototype.hasOwnProperty.call(r,a[o]))return!1;for(o=n;0!=o--;){var l=a[o];if(!e(t[l],r[l]))return!1}return!0}return t!=t&&r!=r}},44:(e,t,r)=>{var n=r(959),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,a={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)l.call(t,n)&&!s.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:o,type:e,key:c,ref:u,props:a,_owner:i.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},728:(e,t,r)=>{e.exports=r(44)},89:e=>{e.exports=r},781:t=>{t.exports=e},531:e=>{e.exports=n},7:e=>{e.exports=o},241:e=>{e.exports=a},146:e=>{e.exports=l},959:e=>{e.exports=t},269:e=>{e.exports=i}},c={};function u(e){var t=c[e];if(void 0!==t)return t.exports;var r=c[e]={exports:{}};return s[e](r,r.exports,u),r.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var d={};return(()=>{u.r(d),u.d(d,{plugin:()=>an});var e=u(781),t=u(728),r=u(89),n=u(959),o=u.n(n),a=u(7),l=Object.defineProperty,i=Object.defineProperties,s=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,b=(e,t,r)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t)=>{for(var r in t||(t={}))p.call(t,r)&&b(e,r,t[r]);if(c)for(var r of c(t))f.call(t,r)&&b(e,r,t[r]);return e};const g=({dataSourceName:e,docsLink:t,hasRequiredFields:n=!0,className:l})=>{const c=(0,a.useTheme2)(),u={container:(0,r.css)({p:{margin:0},"p + p":{marginTop:c.spacing(2)}}),text:(0,r.css)((d=h({},c.typography.body),p={color:c.colors.text.secondary,a:(0,r.css)({color:c.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})},i(d,s(p))))};var d,p;return o().createElement("div",{className:(0,r.cx)(u.container,l)},o().createElement("p",{className:u.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",o().createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),n&&o().createElement("p",{className:u.text},o().createElement("i",null,"Fields marked with * are required")))};var y=Object.defineProperty,m=Object.defineProperties,v=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable,x=(e,t,r)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,C=(e,t)=>{for(var r in t||(t={}))j.call(t,r)&&x(e,r,t[r]);if(O)for(var r of O(t))w.call(t,r)&&x(e,r,t[r]);return e};const P=({children:e,title:t,description:l,isCollapsible:i=!1,isInitiallyOpen:s=!0,kind:c="section",className:u})=>{const{colors:d,typography:p,spacing:f}=(0,a.useTheme2)(),[b,h]=(0,n.useState)(!i||s),g=b?"angle-up":"angle-down",y="sub-section"===c,O=`${b?"Collapse":"Expand"} section ${t}`,j={header:(0,r.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,r.css)({margin:0}),subtitle:(0,r.css)({margin:0,fontWeight:p.fontWeightRegular}),descriptionText:(0,r.css)((w=C({marginTop:f(y?.25:.5),marginBottom:0},p.bodySmall),x={color:d.text.secondary},m(w,v(x)))),content:(0,r.css)({marginTop:f(2)})};var w,x;return o().createElement("div",{className:u},o().createElement("div",{className:j.header},"section"===c?o().createElement("h3",{className:j.title},t):o().createElement("h6",{className:j.subtitle},t),i&&o().createElement(a.IconButton,{name:g,onClick:()=>h(!b),type:"button",size:"xl","aria-label":O})),l&&o().createElement("p",{className:j.descriptionText},l),b&&o().createElement("div",{className:j.content},e))};var S=Object.defineProperty,E=Object.defineProperties,T=Object.getOwnPropertyDescriptors,A=Object.getOwnPropertySymbols,I=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,D=(e,t,r)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const F=e=>{var t,r=e,{children:n}=r,a=((e,t)=>{var r={};for(var n in e)I.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&A)for(var n of A(e))t.indexOf(n)<0&&N.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return o().createElement(P,(t=((e,t)=>{for(var r in t||(t={}))I.call(t,r)&&D(e,r,t[r]);if(A)for(var r of A(t))N.call(t,r)&&D(e,r,t[r]);return e})({},a),E(t,T({kind:"section"}))),n)};var L=Object.defineProperty,k=Object.defineProperties,R=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,_=(e,t,r)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const W=({config:e,onChange:t,description:n,urlPlaceholder:l,urlTooltip:i,urlLabel:s,className:c})=>{const u=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(e.url),d={container:(0,r.css)({maxWidth:578})};return o().createElement(o().Fragment,null,o().createElement(F,{title:"Connection",description:n,className:(0,r.cx)(d.container,c)},o().createElement(a.InlineField,{htmlFor:"connection-url",label:s||"URL",labelWidth:24,tooltip:i||o().createElement(o().Fragment,null,"Specify a complete HTTP URL",o().createElement("br",null),"(for example https://example.com:8080)"),grow:!0,disabled:e.readOnly,required:!0,invalid:!u&&!e.readOnly,error:u?"":"Please enter a valid URL",interactive:!0},o().createElement(a.Input,{id:"connection-url","aria-label":"Data source connection URL",onChange:r=>{return t((n=((e,t)=>{for(var r in t||(t={}))M.call(t,r)&&_(e,r,t[r]);if(q)for(var r of q(t))B.call(t,r)&&_(e,r,t[r]);return e})({},e),o={url:r.currentTarget.value},k(n,R(o))));var n,o},value:e.url||"",placeholder:l||"URL"}))))},$=()=>({inlineFieldNoMarginRight:(0,r.css)({marginRight:0}),inlineFieldWithSecret:(0,r.css)({'[class$="layoutChildrenWrapper"]:first-child':{flexGrow:1}})}),V=({user:e,passwordConfigured:t,userLabel:n="User",userTooltip:l="The username of the data source account",userPlaceholder:i="User",passwordLabel:s="Password",passwordTooltip:c="The password of the data source account",passwordPlaceholder:u="Password",onUserChange:d,onPasswordChange:p,onPasswordReset:f,readOnly:b})=>{const h=$(),g={lastInlineField:(0,r.css)({marginBottom:0})};return o().createElement(o().Fragment,null,o().createElement(a.InlineField,{className:h.inlineFieldNoMarginRight,label:n,labelWidth:24,tooltip:l,required:!0,htmlFor:"basic-auth-user-input",interactive:!0,grow:!0,disabled:b},o().createElement(a.Input,{id:"basic-auth-user-input",placeholder:i,value:e,onChange:e=>d(e.currentTarget.value),required:!0})),o().createElement(a.InlineField,{className:(0,r.cx)(h.inlineFieldNoMarginRight,h.inlineFieldWithSecret,g.lastInlineField),label:s,labelWidth:24,tooltip:c,required:!0,htmlFor:"basic-auth-password-input",interactive:!0,grow:!0,disabled:b},o().createElement(a.SecretInput,{id:"basic-auth-password-input",isConfigured:t,onReset:b?()=>{}:f,placeholder:u,onChange:e=>p(e.currentTarget.value),required:!0})))};var J=Object.defineProperty,U=Object.defineProperties,z=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,Q=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,G=(e,t,r)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const Y=e=>{var t,r=e,{children:n}=r,a=((e,t)=>{var r={};for(var n in e)Q.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&K)for(var n of K(e))t.indexOf(n)<0&&H.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return o().createElement(P,(t=((e,t)=>{for(var r in t||(t={}))Q.call(t,r)&&G(e,r,t[r]);if(K)for(var r of K(t))H.call(t,r)&&G(e,r,t[r]);return e})({},a),U(t,z({kind:"sub-section"}))),n)};var Z=(e=>(e.NoAuth="NoAuth",e.BasicAuth="BasicAuth",e.OAuthForward="OAuthForward",e.CrossSiteCredentials="CrossSiteCredentials",e))(Z||{}),X=Object.defineProperty,ee=Object.defineProperties,te=Object.getOwnPropertyDescriptors,re=Object.getOwnPropertySymbols,ne=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,ae=(e,t,r)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,le=(e,t)=>{for(var r in t||(t={}))ne.call(t,r)&&ae(e,r,t[r]);if(re)for(var r of re(t))oe.call(t,r)&&ae(e,r,t[r]);return e},ie=(e,t)=>ee(e,te(t));const se={[Z.BasicAuth]:{label:"Basic authentication",value:Z.BasicAuth,description:"Authenticate with your data source username and password"},[Z.CrossSiteCredentials]:{label:"Enable cross-site access control requests",value:Z.CrossSiteCredentials,description:"Allow cross-site Access-Control requests with your existing credentials and cookies. This enables the server to authenticate the user and perform authorized requests on their behalf on other domains."},[Z.OAuthForward]:{label:"Forward OAuth Identity",value:Z.OAuthForward,description:"Forward the OAuth access token (and if available: the OIDC ID token) of the user querying to the data source"},[Z.NoAuth]:{label:"No Authentication",value:Z.NoAuth,description:"Data source is available without authentication"}},ce=({selectedMethod:e,mostCommonMethod:t,visibleMethods:l,extendedDefaultOptions:i,customMethods:s,onAuthMethodSelect:c,basicAuth:u,readOnly:d})=>{var p,f,b,h;const[g,y]=(0,n.useState)(!1),{colors:m,spacing:v}=(0,a.useTheme2)(),O=(0,n.useMemo)((()=>{var e;return null!=l?l:[Z.BasicAuth,Z.OAuthForward,Z.NoAuth,...null!=(e=null==s?void 0:s.map((e=>e.id)))?e:[]]}),[s,l]),j=O.length>1,w=(0,n.useMemo)((()=>{var e;const r=null!=(e=null==s?void 0:s.reduce(((e,t)=>(e[t.id]={label:t.label,value:t.id,description:t.description},e)),{}))?e:{},n={};let o;for(o in se)i&&i[o]?n[o]=le(le({},se[o]),i[o]):n[o]=se[o];const a=le(le({},r),n);return O.filter((e=>Boolean(a[e]))).map((e=>{const r=a[e];return e===t&&j?ie(le({},r),{label:`${r.label} (most common)`}):r}))}),[O,s,i,t,j]);let x=e;j?e===Z.NoAuth&&t&&!g&&(x=t):x=O[0];let C=null;x===Z.BasicAuth&&u?C=o().createElement(V,ie(le({},u),{readOnly:d})):x.startsWith("custom-")&&(C=null!=(f=null==(p=null==s?void 0:s.find((e=>e.id===x)))?void 0:p.component)?f:null);const P=j?"Authentication methods":null!=(b=w[0].label)?b:"",S=j?"Choose an authentication method to access the data source":null!=(h=w[0].description)?h:"",E={authMethods:(0,r.css)(le({marginTop:v(2.5)},j&&{padding:v(2),border:`1px solid ${m.border.weak}`})),selectedMethodFields:(0,r.css)({marginTop:v(1.5)})};return o().createElement(Y,{title:P,description:S},o().createElement("div",{className:E.authMethods},j&&o().createElement(a.Select,{options:w,value:x,onChange:e=>{y(!0),c(e.value)},disabled:d}),C&&o().createElement("div",{className:E.selectedMethodFields},C)))},ue=({children:e,enabled:t,label:n,tooltipText:l,onToggle:i,readOnly:s})=>{const{colors:c,spacing:u}=(0,a.useTheme2)(),d={container:(0,r.css)({marginTop:3}),checkboxContainer:(0,r.css)({display:"flex",alignItems:"center"}),infoIcon:(0,r.css)({marginTop:-2,marginLeft:5,color:c.text.secondary}),content:(0,r.css)({margin:u(1,0,2,3)})};return o().createElement("div",{className:d.container},o().createElement("div",{className:d.checkboxContainer},o().createElement(a.Checkbox,{value:t,label:n,onChange:()=>i(!t),disabled:s}),o().createElement(a.Tooltip,{placement:"top",content:l,interactive:!0},o().createElement(a.Icon,{name:"info-circle",className:d.infoIcon,size:"sm"}))),t&&e&&o().createElement("div",{className:d.content},e))},de=({enabled:e,certificateConfigured:t,onToggle:n,onCertificateChange:l,onCertificateReset:i,tooltips:s,readOnly:c})=>{var u;const d=$();return o().createElement(ue,{enabled:e,label:"Add self-signed certificate",tooltipText:"Add your own Certificate Authority (CA) certificate on top of one generated by the certificate authorities for additional security measures",onToggle:e=>n(e),readOnly:c},o().createElement(a.InlineField,{label:"CA Certificate",labelWidth:24,tooltip:null!=(u=null==s?void 0:s.certificateLabel)?u:"Your self-signed certificate",required:!0,htmlFor:"self-signed-certificate-input",interactive:!0,grow:!0,className:(0,r.cx)(d.inlineFieldNoMarginRight,d.inlineFieldWithSecret),disabled:c},o().createElement(a.SecretTextArea,{id:"self-signed-certificate-input",isConfigured:t,onChange:e=>l(e.currentTarget.value),onReset:c?()=>{}:i,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})))},pe=({enabled:e,serverName:t,clientCertificateConfigured:n,clientKeyConfigured:l,onToggle:i,onServerNameChange:s,onClientCertificateChange:c,onClientKeyChange:u,onClientCertificateReset:d,onClientKeyReset:p,tooltips:f,readOnly:b})=>{var h,g,y;const m=$();return o().createElement(ue,{enabled:e,label:"TLS Client Authentication",tooltipText:"Validate using TLS client authentication, in which the server authenticates the client",onToggle:e=>i(e),readOnly:b},o().createElement(a.InlineField,{label:"ServerName",labelWidth:24,tooltip:null!=(h=null==f?void 0:f.serverNameLabel)?h:"A Servername is used to verify the hostname on the returned certificate",required:!0,htmlFor:"client-auth-servername-input",interactive:!0,grow:!0,className:m.inlineFieldNoMarginRight,disabled:b},o().createElement(a.Input,{id:"client-auth-servername-input",placeholder:"domain.example.com",value:t,onChange:e=>s(e.currentTarget.value),required:!0})),o().createElement(a.InlineField,{label:"Client Certificate",labelWidth:24,tooltip:null!=(g=null==f?void 0:f.certificateLabel)?g:"The client certificate can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-certificate-input",interactive:!0,grow:!0,className:(0,r.cx)(m.inlineFieldNoMarginRight,m.inlineFieldWithSecret),disabled:b},o().createElement(a.SecretTextArea,{id:"client-auth-client-certificate-input",isConfigured:n,onChange:e=>c(e.currentTarget.value),onReset:b?()=>{}:d,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})),o().createElement(a.InlineField,{label:"Client Key",labelWidth:24,tooltip:null!=(y=null==f?void 0:f.keyLabel)?y:"The client key can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-key-input",interactive:!0,grow:!0,className:(0,r.cx)(m.inlineFieldNoMarginRight,m.inlineFieldWithSecret),disabled:b},o().createElement(a.SecretTextArea,{id:"client-auth-client-key-input",isConfigured:l,onChange:e=>u(e.currentTarget.value),onReset:b?()=>{}:p,placeholder:"Begins with --- RSA PRIVATE KEY CERTIFICATE ---",rows:6,required:!0})))},fe=({enabled:e,onToggle:t,readOnly:r})=>o().createElement(ue,{enabled:e,label:"Skip TLS certificate validation",tooltipText:"Skipping TLS certificate validation is not recommended unless absolutely necessary or for testing",onToggle:e=>t(e),readOnly:r});var be=Object.defineProperty,he=Object.defineProperties,ge=Object.getOwnPropertyDescriptors,ye=Object.getOwnPropertySymbols,me=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable,Oe=(e,t,r)=>t in e?be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,je=(e,t)=>{for(var r in t||(t={}))me.call(t,r)&&Oe(e,r,t[r]);if(ye)for(var r of ye(t))ve.call(t,r)&&Oe(e,r,t[r]);return e},we=(e,t)=>he(e,ge(t));const xe=({selfSignedCertificate:e,TLSClientAuth:t,skipTLSVerification:n,readOnly:l})=>{const{spacing:i}=(0,a.useTheme2)(),s={container:(0,r.css)({marginTop:i(3)})};return o().createElement(Y,{className:s.container,title:"TLS settings",description:"Additional security measures that can be applied on top of authentication"},o().createElement(de,we(je({},e),{readOnly:l})),o().createElement(pe,we(je({},t),{readOnly:l})),o().createElement(fe,we(je({},n),{readOnly:l})))};var Ce=Object.defineProperty,Pe=Object.defineProperties,Se=Object.getOwnPropertyDescriptors,Ee=Object.getOwnPropertySymbols,Te=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable,Ie=(e,t,r)=>t in e?Ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ne=(e,t)=>{for(var r in t||(t={}))Te.call(t,r)&&Ie(e,r,t[r]);if(Ee)for(var r of Ee(t))Ae.call(t,r)&&Ie(e,r,t[r]);return e},De=(e,t)=>Pe(e,Se(t));const Fe=({header:e,onChange:t,onBlur:n,onDelete:l,readOnly:i})=>{const{spacing:s}=(0,a.useTheme2)(),c=$(),u={container:(0,r.css)({alignItems:"center"}),input:(0,r.css)({minWidth:"100%"}),headerNameField:(0,r.css)({width:"40%",marginRight:0,paddingRight:s(1)}),headerValueField:(0,r.css)({width:"45%",marginRight:0}),removeHeaderBtn:(0,r.css)({margin:"0 0 3px 10px"})};return o().createElement(o().Fragment,null,o().createElement(a.InlineFieldRow,{className:u.container},o().createElement(a.InlineField,{label:"Header",labelWidth:9,grow:!0,className:u.headerNameField,htmlFor:`custom-header-${e.id}-name-input`,disabled:i},o().createElement(a.Input,{id:`custom-header-${e.id}-name-input`,placeholder:"X-Custom-Header",value:e.name,width:12,onChange:r=>t(De(Ne({},e),{name:r.currentTarget.value})),onBlur:n,className:u.input})),o().createElement(a.InlineField,{label:"Value",labelWidth:9,grow:!0,className:(0,r.cx)(c.inlineFieldWithSecret,u.headerValueField),htmlFor:`custom-header-${e.id}-value-input`,disabled:i},o().createElement(a.SecretInput,{id:`custom-header-${e.id}-value-input`,isConfigured:e.configured,placeholder:"Header value",value:e.value,width:12,onChange:r=>t(De(Ne({},e),{value:r.currentTarget.value})),onReset:i?()=>{}:()=>t(De(Ne({},e),{configured:!1,value:""})),onBlur:n,className:u.input})),o().createElement(a.IconButton,{name:"trash-alt",tooltip:"Remove header",tooltipPlacement:"top",className:u.removeHeaderBtn,onClick:l,type:"button",disabled:i})))};var Le=Object.defineProperty,ke=Object.defineProperties,Re=Object.getOwnPropertyDescriptors,qe=Object.getOwnPropertySymbols,Me=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable,_e=(e,t,r)=>t in e?Le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,We=(e,t)=>{for(var r in t||(t={}))Me.call(t,r)&&_e(e,r,t[r]);if(qe)for(var r of qe(t))Be.call(t,r)&&_e(e,r,t[r]);return e},$e=(e,t)=>ke(e,Re(t));const Ve=({headers:e,onChange:t,readOnly:l})=>{const{spacing:i}=(0,a.useTheme2)(),[s,c]=(0,n.useState)(e.map((e=>$e(We({},e),{id:Je(),value:""}))));(0,n.useEffect)((()=>{c((t=>{let r=!1;const n=t.map((t=>{var n;const o=null==(n=e.find((e=>e.name===t.name)))?void 0:n.configured;return void 0!==o&&t.configured!==o?(r=!0,$e(We({},t),{configured:o})):t}));return r?n:t}))}),[e]);const u=()=>{t(s.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))},d={container:(0,r.css)({marginTop:i(3)}),addHeaderButton:(0,r.css)({marginTop:i(1.5)})};return o().createElement("div",{className:d.container},o().createElement(Y,{title:"HTTP headers",description:"Pass along additional context and metadata about the request/response",isCollapsible:!0,isInitiallyOpen:s.length>0},o().createElement("div",null,s.map((e=>o().createElement(Fe,{key:e.id,header:e,onChange:e=>((e,t)=>{c(s.map((r=>r.id===e?We({},t):r)))})(e.id,e),onDelete:()=>(e=>{const r=s.findIndex((t=>t.id===e));if(-1===r)return;const n=[...s];n.splice(r,1),c(n),t(n.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))})(e.id),onBlur:u,readOnly:l})))),o().createElement("div",{className:d.addHeaderButton},o().createElement(a.Button,{icon:"plus",variant:"secondary",fill:"outline",onClick:()=>{c([...s,{id:Je(),name:"",value:"",configured:!1}])},disabled:l},0===s.length?"Add header":"Add another header"))))};function Je(){return Math.random().toString(16).slice(2)}var Ue=Object.defineProperty,ze=Object.defineProperties,Ke=Object.getOwnPropertyDescriptors,Qe=Object.getOwnPropertySymbols,He=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable,Ye=(e,t,r)=>t in e?Ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ze=(e,t)=>{for(var r in t||(t={}))He.call(t,r)&&Ye(e,r,t[r]);if(Qe)for(var r of Qe(t))Ge.call(t,r)&&Ye(e,r,t[r]);return e},Xe=(e,t)=>ze(e,Ke(t));const et=({selectedMethod:e,mostCommonMethod:t,visibleMethods:n,extendedDefaultOptions:a,customMethods:l,onAuthMethodSelect:i,basicAuth:s,TLS:c,customHeaders:u,readOnly:d=!1})=>{const p={container:(0,r.css)({maxWidth:578})};return o().createElement("div",{className:p.container},o().createElement(F,{title:"Authentication"},o().createElement(ce,{selectedMethod:e,mostCommonMethod:t,customMethods:l,visibleMethods:n,extendedDefaultOptions:a,onAuthMethodSelect:i,basicAuth:s,readOnly:d}),c&&o().createElement(xe,Xe(Ze({},c),{readOnly:d})),u&&o().createElement(Ve,Xe(Ze({},u),{readOnly:d}))))};var tt=Object.defineProperty,rt=Object.defineProperties,nt=Object.getOwnPropertyDescriptors,ot=Object.getOwnPropertySymbols,at=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable,it=(e,t,r)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,st=(e,t)=>{for(var r in t||(t={}))at.call(t,r)&&it(e,r,t[r]);if(ot)for(var r of ot(t))lt.call(t,r)&&it(e,r,t[r]);return e},ct=(e,t)=>rt(e,nt(t));const ut="httpHeaderName",dt="httpHeaderValue";function pt({config:e,onChange:t}){return{selectedMethod:ft(e),onAuthMethodSelect:bt(e,t),basicAuth:ht(e,t),TLS:gt(e,t),customHeaders:yt(e,t),readOnly:e.readOnly}}function ft(e){return e.basicAuth?Z.BasicAuth:e.withCredentials?Z.CrossSiteCredentials:e.jsonData.oauthPassThru?Z.OAuthForward:Z.NoAuth}function bt(e,t){return r=>{t(ct(st({},e),{basicAuth:r===Z.BasicAuth,withCredentials:r===Z.CrossSiteCredentials,jsonData:ct(st({},e.jsonData),{oauthPassThru:r===Z.OAuthForward})}))}}function ht(e,t){return{user:e.basicAuthUser,passwordConfigured:e.secureJsonFields.basicAuthPassword,onUserChange:r=>t(ct(st({},e),{basicAuthUser:r})),onPasswordChange:r=>t(ct(st({},e),{secureJsonData:ct(st({},e.secureJsonData),{basicAuthPassword:r})})),onPasswordReset:()=>t(ct(st({},e),{secureJsonData:ct(st({},e.secureJsonData),{basicAuthPassword:""}),secureJsonFields:ct(st({},e.secureJsonFields),{basicAuthPassword:!1})}))}}function gt(e,t){return{selfSignedCertificate:{enabled:Boolean(e.jsonData.tlsAuthWithCACert),certificateConfigured:e.secureJsonFields.tlsCACert,onToggle:r=>t(ct(st({},e),r?{jsonData:ct(st({},e.jsonData),{tlsAuthWithCACert:r})}:{jsonData:ct(st({},e.jsonData),{tlsAuthWithCACert:r}),secureJsonData:ct(st({},e.secureJsonData),{tlsCACert:""}),secureJsonFields:ct(st({},e.secureJsonFields),{tlsCACert:!1})})),onCertificateChange:r=>t(ct(st({},e),{secureJsonData:ct(st({},e.secureJsonData),{tlsCACert:r})})),onCertificateReset:()=>t(ct(st({},e),{secureJsonData:ct(st({},e.secureJsonData),{tlsCACert:""}),secureJsonFields:ct(st({},e.secureJsonFields),{tlsCACert:!1})}))},TLSClientAuth:{enabled:e.jsonData.tlsAuth,serverName:e.jsonData.serverName,clientCertificateConfigured:e.secureJsonFields.tlsClientCert,clientKeyConfigured:e.secureJsonFields.tlsClientKey,onToggle:r=>t(ct(st({},e),r?{jsonData:ct(st({},e.jsonData),{tlsAuth:r})}:{jsonData:ct(st({},e.jsonData),{tlsAuth:r,serverName:""}),secureJsonData:ct(st({},e.secureJsonData),{tlsClientCert:"",tlsClientKey:""}),secureJsonFields:ct(st({},e.secureJsonFields),{tlsClientCert:!1,tlsClientKey:!1})})),onServerNameChange:r=>t(ct(st({},e),{jsonData:ct(st({},e.jsonData),{serverName:r})})),onClientCertificateChange:r=>t(ct(st({},e),{secureJsonData:ct(st({},e.secureJsonData),{tlsClientCert:r})})),onClientCertificateReset:()=>t(ct(st({},e),{secureJsonData:ct(st({},e.secureJsonData),{tlsClientCert:""}),secureJsonFields:ct(st({},e.secureJsonFields),{tlsClientCert:!1})})),onClientKeyChange:r=>t(ct(st({},e),{secureJsonData:ct(st({},e.secureJsonData),{tlsClientKey:r})})),onClientKeyReset:()=>t(ct(st({},e),{secureJsonData:ct(st({},e.secureJsonData),{tlsClientKey:""}),secureJsonFields:ct(st({},e.secureJsonFields),{tlsClientKey:!1})}))},skipTLSVerification:{enabled:e.jsonData.tlsSkipVerify,onToggle:r=>t(ct(st({},e),{jsonData:ct(st({},e.jsonData),{tlsSkipVerify:r})}))}}}function yt(e,t){return{headers:Object.keys(e.jsonData).filter((e=>e.startsWith(ut))).sort().map((t=>{var r;const n=t.slice(ut.length);return{name:e.jsonData[t],configured:null!=(r=e.secureJsonFields[`${dt}${n}`])&&r}})),onChange:r=>{const n=Object.fromEntries(Object.entries(e.jsonData).filter((([e])=>!e.startsWith(ut)))),o=Object.fromEntries(Object.entries(e.secureJsonData||{}).filter((([e])=>!e.startsWith(dt)))),a=Object.fromEntries(Object.entries(e.secureJsonFields).filter((([e])=>!e.startsWith(dt))));r.forEach(((e,t)=>{n[`${ut}${t+1}`]=e.name,e.configured?a[`${dt}${t+1}`]=!0:o[`${dt}${t+1}`]=e.value})),t(ct(st({},e),{jsonData:n,secureJsonData:o,secureJsonFields:a}))}}}var mt=Object.defineProperty,vt=Object.defineProperties,Ot=Object.getOwnPropertyDescriptors,jt=Object.getOwnPropertySymbols,wt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable,Ct=(e,t,r)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Pt=(e,t)=>{for(var r in t||(t={}))wt.call(t,r)&&Ct(e,r,t[r]);if(jt)for(var r of jt(t))xt.call(t,r)&&Ct(e,r,t[r]);return e},St=(e,t)=>vt(e,Ot(t));const Et=({config:e,onChange:t,className:n})=>{const l={container:(0,r.css)({maxWidth:578})};return o().createElement(Y,{title:"Advanced HTTP settings",className:(0,r.cx)(l.container,n)},o().createElement(a.InlineField,{htmlFor:"advanced-http-cookies",label:"Allowed cookies",labelWidth:24,tooltip:"Grafana proxy deletes forwarded cookies by default. Specify cookies by name that should be forwarded to the data source.",disabled:e.readOnly,grow:!0},o().createElement(a.TagsInput,{id:"advanced-http-cookies",placeholder:"New cookie (hit enter to add)",tags:e.jsonData.keepCookies,onChange:r=>{t(St(Pt({},e),{jsonData:St(Pt({},e.jsonData),{keepCookies:r})}))}})),o().createElement(a.InlineField,{htmlFor:"advanced-http-timeout",label:"Timeout",labelWidth:24,tooltip:"HTTP request timeout in seconds",disabled:e.readOnly,grow:!0},o().createElement(a.Input,{id:"advanced-http-timeout",type:"number",min:0,placeholder:"Timeout in seconds","aria-label":"Timeout in seconds",value:e.jsonData.timeout,onChange:r=>{t(St(Pt({},e),{jsonData:St(Pt({},e.jsonData),{timeout:parseInt(r.currentTarget.value,10)})}))}})))};var Tt=u(531);function At(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function It(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){At(e,t,r[t])}))}return e}function Nt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Dt=e=>({container:(0,r.css)({marginBottom:e.spacing(2),maxWidth:"900px"})});var Ft=u(513),Lt=u.n(Ft),kt=u(241),Rt=u(146),qt=u.n(Rt),Mt=u(269);function Bt(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function _t(e){const r=(o=e.profileTypes,(0,n.useMemo)((()=>{if(!o)return[];let e=new Map;for(let r of o){var t;let n=[];r.id.indexOf(":")>-1&&(n=r.id.split(":"));const[o,a]=n;e.has(o)||e.set(o,{label:o,value:o,items:[]}),null===(t=e.get(o))||void 0===t||t.items.push({label:a,value:r.id})}return Array.from(e.values())}),[o]));var o,l;return(0,t.jsx)(a.Cascader,{placeholder:e.placeholder,separator:"-",displayAllSelectedLevels:!0,initialValue:e.initialProfileTypeId,allowCustomValue:!0,onSelect:e.onChange,options:r,changeOnSelect:!1,width:null!==(l=e.width)&&void 0!==l?l:26})}function Wt(e,t){const[r,o]=(0,n.useState)(),a={to:6e4*Math.ceil(((null==t?void 0:t.to.valueOf())||0)/6e4),from:6e4*Math.floor(((null==t?void 0:t.from.valueOf())||0)/6e4)};return(0,n.useEffect)((()=>{var t;(t=function*(){const t=yield e.getProfileTypes(a.from.valueOf(),a.to.valueOf());o(t)},function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function l(e){Bt(a,n,o,l,i,"next",e)}function i(e){Bt(a,n,o,l,i,"throw",e)}l(void 0)}))})()}),[e,a.from,a.to]),r}function $t(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function Vt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Vt(e,t,r[t])}))}return e}function Ut(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function zt(e){var r,n;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.InlineFieldRow,{children:(0,t.jsx)(a.InlineField,{label:"Query type",labelWidth:20,tooltip:(0,t.jsx)("div",{children:"The Pyroscope data source plugin provides the following query types for template variables"}),children:(0,t.jsx)(a.Select,{placeholder:"Select query type","aria-label":"Query type",width:25,options:[{label:"Profile type",value:"profileType"},{label:"Label",value:"label"},{label:"Label value",value:"labelValue"}],onChange:t=>{"profileType"===t.value&&e.onChange({type:t.value,refId:e.query.refId}),"label"!==t.value&&"labelValue"!==t.value||e.onChange({type:t.value,refId:e.query.refId,profileTypeId:"profileType"!==e.query.type?e.query.profileTypeId:""})},value:e.query.type})})}),("labelValue"===e.query.type||"label"===e.query.type)&&(0,t.jsx)(Qt,{datasource:e.datasource,initialValue:e.query.profileTypeId,onChange:t=>{"label"!==e.query.type&&"labelValue"!==e.query.type||e.onChange(Ut(Jt({},e.query),{profileTypeId:t}))},range:e.range}),"labelValue"===e.query.type&&(0,t.jsx)(Kt,{value:e.query.labelName,datasource:e.datasource,profileTypeId:e.query.profileTypeId,onChange:t=>{"labelValue"===e.query.type&&e.onChange(Ut(Jt({},e.query),{labelName:t}))},from:(null===(r=e.range)||void 0===r?void 0:r.from.valueOf())||Date.now().valueOf()-864e5,to:(null===(n=e.range)||void 0===n?void 0:n.to.valueOf())||Date.now().valueOf()})]})}function Kt(e){const[r,o]=(0,n.useState)();(0,n.useEffect)((()=>{var t;(t=function*(){o(yield e.datasource.getLabelNames(e.profileTypeId?Ht(e.profileTypeId):"{}",e.from,e.to))},function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function l(e){$t(a,n,o,l,i,"next",e)}function i(e){$t(a,n,o,l,i,"throw",e)}l(void 0)}))})()}),[e.datasource,e.profileTypeId,e.to,e.from]);const l=r?r.map((e=>({label:e,value:e}))):[];return r&&e.value&&!r.find((t=>t===e.value))&&l.push({value:e.value,label:e.value}),(0,t.jsx)(a.InlineFieldRow,{children:(0,t.jsx)(a.InlineField,{label:"Label",labelWidth:20,tooltip:(0,t.jsx)("div",{children:"Select label for which to retrieve available values"}),children:(0,t.jsx)(a.Select,{allowCustomValue:!0,placeholder:"Select label","aria-label":"Select label",width:25,options:l,onChange:t=>e.onChange(t.value),value:e.value})})})}function Qt(e){const r=Wt(e.datasource,e.range);return(0,t.jsx)(a.InlineFieldRow,{children:(0,t.jsx)(a.InlineField,{label:"Profile type","aria-label":"Profile type",labelWidth:20,tooltip:(0,t.jsx)("div",{children:"Select profile type for which to retrieve available labels"}),children:r?(0,t.jsx)(_t,{onChange:e.onChange,profileTypes:r,initialProfileTypeId:e.initialValue}):(0,t.jsx)(a.LoadingPlaceholder,{text:"Loading"})})})}function Ht(e){return`{__profile_type__="${e}"}`}function Gt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Yt extends e.CustomVariableSupport{query(e){return"profileType"===e.targets[0].type?(0,Mt.from)(this.dataAPI.getProfileTypes(e.range.from.valueOf(),e.range.to.valueOf())).pipe((0,Mt.map)((e=>({data:e.map((e=>({text:e.label,value:e.id})))})))):"label"===e.targets[0].type?e.targets[0].profileTypeId?(0,Mt.from)(this.dataAPI.getLabelNames(Ht(e.targets[0].profileTypeId),e.range.from.valueOf(),e.range.to.valueOf())).pipe((0,Mt.map)((e=>({data:e.map((e=>({text:e})))})))):(0,Mt.of)({data:[]}):"labelValue"===e.targets[0].type&&e.targets[0].labelName&&e.targets[0].profileTypeId?(0,Mt.from)(this.dataAPI.getLabelValues(Ht(e.targets[0].profileTypeId),e.targets[0].labelName,e.range.from.valueOf(),e.range.to.valueOf())).pipe((0,Mt.map)((e=>({data:e.map((e=>({text:e})))})))):(0,Mt.of)({data:[]})}constructor(e){super(),Gt(this,"dataAPI",void 0),Gt(this,"editor",void 0),this.dataAPI=e,this.editor=zt}}function Zt(e){const t=[];for(const r of e)if(r instanceof Rt.Token&&"context-labels"===r.type){let e="",n="",o="";const a=Array.isArray(r.content)?r.content:[r.content];for(let r of a)if("string"==typeof r){let e;e=r,"="!==e&&"!="!==e&&"=~"!==e&&"!~"!==e||(o=e)}else if(r instanceof Rt.Token)switch(r.type){case"label-key":e=er(r);break;case"label-value":n=er(r),n=n.substring(1,n.length-1);const a=tr[o];a&&t.push({name:e,operator:a,value:n})}}return t}function Xt(e){const t=e.map((e=>{const t=rr[e.operator];return t?`${e.name}${t}"${e.value}"`:""})).filter((e=>""!==e)).join(", ");return t?`{${t}}`:""}function er(e){return"string"==typeof e.content?e.content:""}const tr={"=":e.AbstractLabelOperator.Equal,"!=":e.AbstractLabelOperator.NotEqual,"=~":e.AbstractLabelOperator.EqualRegEx,"!~":e.AbstractLabelOperator.NotEqualRegEx},rr=(0,kt.invert)(tr);function nr(t,r,n,o="="){if(!r||!n)throw new Error("Need label to add to query.");let a=Zt(qt().tokenize(t,or));var l;return a=a.filter((e=>e.name!==r)),a.push({name:r,value:n.toString(),operator:null!==(l=tr[o])&&void 0!==l?l:e.AbstractLabelOperator.Equal}),Xt(a)}const or={"context-labels":{pattern:/\{[^}]*(?=}?)/,greedy:!0,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-zA-Z_]\w*(?=\s*(=|!=|=~|!~))/,alias:"attr-name",greedy:!0},"label-value":{pattern:/"(?:\\.|[^\\"])*"/,greedy:!0,alias:"attr-value"},punctuation:/[{]/}},punctuation:/[{}(),.]/};function ar(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function lr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function l(e){ar(a,n,o,l,i,"next",e)}function i(e){ar(a,n,o,l,i,"throw",e)}l(void 0)}))}}function ir(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ir(e,t,r[t])}))}return e}function cr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class ur extends Tt.DataSourceWithBackend{query(e){const t=e.targets.filter((e=>e.profileTypeId)).map((t=>""===t.labelSelector?cr(sr({},t),{labelSelector:"{}"}):pr(t,e.app)));return t.length?super.query(cr(sr({},e),{targets:t})):(0,Mt.of)({data:[]})}getProfileTypes(e,t){var r=this;return lr((function*(){return yield r.getResource("profileTypes",{start:e,end:t})}))()}getAllProfileTypes(){var e=this;return lr((function*(){return yield e.getResource("profileTypes")}))()}getLabelNames(e,t,r){var n=this;return lr((function*(){return yield n.getResource("labelNames",{query:n.templateSrv.replace(e),start:t,end:r})}))()}getLabelValues(e,t,r,n){var o=this;return lr((function*(){return yield o.getResource("labelValues",{label:o.templateSrv.replace(t),query:o.templateSrv.replace(e),start:r,end:n})}))()}getTagKeys(e){var t=this;return lr((function*(){const r=t.adhocFilterData(e);return(yield t.getLabelNames(r.query,r.from,r.to)).map((e=>({text:e})))}))()}getTagValues(e){var t=this;return lr((function*(){const r=t.adhocFilterData(e);return(yield t.getLabelValues(r.query,e.key,r.from,r.to)).map((e=>({text:e})))}))()}adhocFilterData(e){var t,r,n,o;return{from:null!==(n=null===(t=e.timeRange)||void 0===t?void 0:t.from.valueOf())&&void 0!==n?n:Date.now()-864e5,to:null!==(o=null===(r=e.timeRange)||void 0===r?void 0:r.to.valueOf())&&void 0!==o?o:Date.now(),query:"{"+e.filters.map((e=>`${e.key}${e.operator}"${e.value}"`)).join(",")+"}"}}applyTemplateVariables(e,t,r){var n;let o=this.templateSrv.replace(null!==(n=e.labelSelector)&&void 0!==n?n:"",t);if(r&&o)for(const e of r)o=nr(o,e.key,e.value,e.operator);var a;return cr(sr({},e),{labelSelector:o,profileTypeId:this.templateSrv.replace(null!==(a=e.profileTypeId)&&void 0!==a?a:"",t)})}importFromAbstractQueries(e){var t=this;return lr((function*(){return e.map((e=>t.importFromAbstractQuery(e)))}))()}importFromAbstractQuery(e){return{refId:e.refId,labelSelector:Xt(e.labelMatchers),queryType:"both",profileTypeId:"",groupBy:[]}}exportToAbstractQueries(e){var t=this;return lr((function*(){return e.map((e=>t.exportToAbstractQuery(e)))}))()}exportToAbstractQuery(e){const t=e.labelSelector;if(!t||0===t.length)return{refId:e.refId,labelMatchers:[]};const r=qt().tokenize(t,or);return{refId:e.refId,labelMatchers:Zt(r)}}getDefaultQuery(e){return dr}constructor(e,t=(0,Tt.getTemplateSrv)()){super(e),ir(this,"templateSrv",void 0),this.templateSrv=t,this.variables=new Yt(this)}}const dr=cr(sr({},{groupBy:[],labelSelector:"{}",spanSelector:[]}),{queryType:"both"});function pr(t,r){let n=sr({},dr,t);return r!==e.CoreApp.Explore&&"both"===n.queryType&&(n.queryType="profile"),n}function fr(e){const r=(0,a.useStyles2)(br,e);return(0,t.jsx)("div",{className:r.root,children:e.children})}const br=(e,t)=>{var n,o,a;return{root:(0,r.css)({display:"flex",flexDirection:null!==(n=t.direction)&&void 0!==n?n:"row",flexWrap:null===(o=t.wrap)||void 0===o||o?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!==(a=t.gap)&&void 0!==a?a:2),flexGrow:t.flexGrow})}};function hr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){hr(e,t,r[t])}))}return e}const yr=({children:e,stackProps:r})=>{const n=(0,a.useStyles2)(mr);return(0,t.jsx)("div",{className:n.root,children:(0,t.jsx)(fr,(o=gr({gap:2},r),l={children:e},l=null!=l?l:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(l)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(l,e))})),o))});var o,l},mr=e=>({root:(0,r.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.radius.default})}),vr=({children:e})=>(0,t.jsx)(fr,{gap:.5,direction:"column",children:e});var Or=function(){return Or=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Or.apply(this,arguments)};Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const jr={id:"pyroscopeql",extensions:[".pyroscopeql"],aliases:["pyroscope","pyroscopeql"],mimetypes:[],def:{language:{ignoreCase:!1,defaultToken:"",tokenPostfix:".pyroscopeql",keywords:[],operators:[],symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,integersuffix:/(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,floatsuffix:/[fFlL]?/,tokenizer:{root:[[/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,"tag"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/\d+/,"number"],[/\d*\d+[eE]([\-+]?\d+)?(@floatsuffix)/,"number.float"],[/\d*\.\d+([eE][\-+]?\d+)?(@floatsuffix)/,"number.float"],[/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/,"number.hex"],[/0[0-7']*[0-7](@integersuffix)/,"number.octal"],[/0[bB][0-1']*[0-1](@integersuffix)/,"number.binary"],[/\d[\d']*\d(@integersuffix)/,"number"],[/\d(@integersuffix)/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],clauses:[[/[^(,)]/,"tag"],[/\)/,"identifier","@pop"]],whitespace:[[/[ \t\r\n]+/,"white"]]}},languageConfiguration:{wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()=+\[{\]}\\|;:'",<>\/?\s]+)/g,brackets:[["{","}"]],autoClosingPairs:[{open:"{",close:"}"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}}}};function wr(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function xr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Cr{init(e,t){this.labels=e,this.getLabelValues=t}provideCompletionItems(e,t){var r;if(!this.monaco||!this.editor)throw new Error("provideCompletionItems called before CompletionProvider was initialized");if((null===(r=this.editor.getModel())||void 0===r?void 0:r.id)!==e.id)return{suggestions:[]};const{range:n,offset:o}=function(e,t,r){const n=t.getWordAtPosition(r),o=null!=n?e.Range.lift({startLineNumber:r.lineNumber,endLineNumber:r.lineNumber,startColumn:n.startColumn,endColumn:n.endColumn}):e.Range.fromPositions(r),a={column:r.column,lineNumber:r.lineNumber};return{offset:t.getOffsetAt(a),range:o}}(this.monaco,e,t),a=function(e,t){if(""===e)return{type:"EMPTY"};const r=e.matchAll(Tr),n=Array.from(r).reduce(((e,t)=>{const[r,n,o]=t[1];return e.push({name:n,value:o}),e}),[]),o=e.substring(0,t).match(Ar);if(o)return{type:"IN_LABEL_VALUE",labelName:o[1],betweenQuotes:!!o[2],otherLabels:n};return e.substring(0,t).match(Ir)?{type:"IN_LABEL_NAME",otherLabels:n}:{type:"UNKNOWN"}}(e.getValue(),o);return this.getCompletions(a).then((e=>{const t=e.length.toString().length;return{suggestions:e.map(((e,r)=>({kind:Pr(e.type,this.monaco),label:e.label,insertText:e.insertText,sortText:r.toString().padStart(t,"0"),range:n})))}}))}getCompletions(e){var t,r=this;return(t=function*(){switch(e.type){case"UNKNOWN":return[];case"EMPTY":return r.labels.map((e=>({label:e,insertText:`{${e}="`,type:"LABEL_NAME"})));case"IN_LABEL_NAME":return r.labels.map((e=>({label:e,insertText:e,type:"LABEL_NAME"})));case"IN_LABEL_VALUE":let t=yield r.getLabelValues(e.labelName);return t?t.map((t=>({label:t,insertText:e.betweenQuotes?t:`"${t}"`,type:"LABEL_VALUE"}))):[];default:throw new Error(`Unexpected situation ${e}`)}},function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function l(e){wr(a,n,o,l,i,"next",e)}function i(e){wr(a,n,o,l,i,"throw",e)}l(void 0)}))})()}constructor(){xr(this,"triggerCharacters",["{",",","[","(","=","~"," ",'"']),xr(this,"monaco",void 0),xr(this,"editor",void 0),xr(this,"labels",[]),xr(this,"getLabelValues",(()=>Promise.resolve([])))}}function Pr(e,t){switch(e){case"LABEL_NAME":return t.languages.CompletionItemKind.Enum;case"LABEL_VALUE":return t.languages.CompletionItemKind.EnumMember;default:throw new Error(`Unexpected CompletionType: ${e}`)}}const Sr=/[a-zA-Z_][a-zA-Z0-9_]*/,Er=/[^"]*/,Tr=new RegExp(`(${Sr.source})="(${Er.source})"`,"g"),Ar=new RegExp(`(${Sr.source})=("?)${Er.source}$`),Ir=new RegExp(/[{,]\s*[a-zA-Z0-9_]*$/);function Nr(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function Dr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function l(e){Nr(a,n,o,l,i,"next",e)}function i(e){Nr(a,n,o,l,i,"throw",e)}l(void 0)}))}}function Fr(e){const r=function(e,t){const r=(0,n.useRef)();void 0===r.current&&(r.current=new Cr),function(e,t){void 0===t&&(t=[]);var r=function(e,t,r){void 0===t&&(t=[]),void 0===r&&(r={loading:!1});var o,a,l=(0,n.useRef)(0),i=(o=(0,n.useRef)(!1),a=(0,n.useCallback)((function(){return o.current}),[]),(0,n.useEffect)((function(){return o.current=!0,function(){o.current=!1}}),[]),a),s=(0,n.useState)(r),c=s[0],u=s[1],d=(0,n.useCallback)((function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=++l.current;return c.loading||u((function(e){return Or(Or({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return i()&&n===l.current&&u({value:e,loading:!1}),e}),(function(e){return i()&&n===l.current&&u({error:e,loading:!1}),e}))}),t);return[c,d]}(e,t,{loading:!0}),o=(r[0],r[1]);(0,n.useEffect)((function(){o()}),[o])}(Dr((function*(){r.current&&r.current.init(t||[],e)})),[t,e]);const o=(0,n.useRef)(null);return(0,n.useEffect)((()=>()=>{var e;null===(e=o.current)||void 0===e||e.call(o)}),[]),(e,t)=>{if(r.current){r.current.editor=e,r.current.monaco=t;const{dispose:n}=t.languages.registerCompletionItemProvider(Rr,r.current);o.current=n}}}(e.getLabelValues,e.labels),o=(0,a.useStyles2)(Mr),l=(s=e.onRunQuery,(c=(0,n.useRef)(s)).current=s,c),i=(0,n.useRef)(null);var s,c;return(0,t.jsx)("div",{className:o.wrapper,ref:i,children:(0,t.jsx)(a.CodeEditor,{value:e.value,language:Rr,onChange:e.onChange,containerStyles:o.queryField,monacoOptions:{folding:!1,fontSize:14,lineNumbers:"off",overviewRulerLanes:0,renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,wordWrap:"on",padding:{top:4,bottom:5}},onBeforeEditorMount:qr,onEditorDidMount:(e,t)=>{r(e,t);const n=()=>{const t=i.current;if(null!==t){const r=e.getContentHeight();t.style.height=`${r+Lr}px`,t.style.width="100%";const n=t.clientWidth;e.layout({width:n,height:r})}};e.onDidContentSizeChange(n),n(),e.addCommand(t.KeyMod.Shift|t.KeyCode.Enter,(()=>{l.current(e.getValue())}))}})})}const Lr=2;let kr=!1;const Rr="pyroscopeql";function qr(e){if(!1===kr){kr=!0;const{aliases:t,extensions:r,mimetypes:n,def:o}=jr;e.languages.register({id:Rr,aliases:t,extensions:r,mimetypes:n}),e.languages.setMonarchTokensProvider(Rr,o.language),e.languages.setLanguageConfiguration(Rr,o.languageConfiguration)}}const Mr=()=>({queryField:r.css`
      label: LabelsEditorQueryField;
      flex: 1;
      // Not exactly sure but without this the editor does not shrink after resizing (so you can make it bigger but not
      // smaller). At the same time this does not actually make the editor 100px because it has flex 1 so I assume
      // this should sort of act as a flex-basis (but flex-basis does not work for this). So yeah CSS magic.
      width: 100px;
    `,wrapper:r.css`
      label: LabelsEditorWrapper;
      display: flex;
      flex: 1;
      border: 1px solid rgba(36, 41, 46, 0.3);
      border-radius: 2px;
    `});function Br(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _r(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Br(e,t,r[t])}))}return e}const Wr=e=>{const{label:r,optional:n,tooltip:o,children:l,width:i}=e,s=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,["label","optional","tooltip","children","width"]),c=(0,a.useStyles2)($r,i),u=(null==s?void 0:s.htmlFor)||(null===a.ReactUtils||void 0===a.ReactUtils?void 0:a.ReactUtils.getChildId(l)),d=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("label",{className:c.label,htmlFor:u,children:[r,n&&(0,t.jsx)("span",{className:c.optional,children:" - optional"}),o&&(0,t.jsx)(a.Tooltip,{placement:"top",content:o,theme:"info",children:(0,t.jsx)(a.Icon,{name:"info-circle",size:"sm",className:c.icon})})]}),(0,t.jsx)("span",{className:c.space})]});return(0,t.jsx)("div",{className:c.root,children:(0,t.jsx)(a.Field,(p=_r({className:c.field,label:d},s),f={children:l},f=null!=f?f:{},Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(f)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(f)).forEach((function(e){Object.defineProperty(p,e,Object.getOwnPropertyDescriptor(f,e))})),p))});var p,f},$r=(e,t)=>({space:(0,r.css)({paddingRight:e.spacing(0),paddingBottom:e.spacing(.5)}),root:(0,r.css)({minWidth:e.spacing(null!=t?t:0)}),label:(0,r.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,r.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,r.css)({marginBottom:0}),icon:(0,r.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})});var Vr=function(e,t){return"boolean"==typeof t?t:!e};const Jr=function(e){return(0,n.useReducer)(Vr,e)};function Ur({title:e,children:r,collapsedInfo:n}){const[o,l]=Jr(!1),i=(0,a.useStyles2)(zr);return(0,t.jsx)("div",{className:i.wrapper,children:(0,t.jsx)(a.Collapse,{className:i.collapse,collapsible:!0,isOpen:o,onToggle:l,label:(0,t.jsxs)(a.Stack,{gap:0,children:[(0,t.jsx)("h6",{className:i.title,children:e}),!o&&(0,t.jsx)("div",{className:i.description,children:n.map(((e,r)=>(0,t.jsx)("span",{children:e},r)))})]}),children:(0,t.jsx)("div",{className:i.body,children:r})})})}const zr=e=>({collapse:(0,r.css)({backgroundColor:"unset",border:"unset",marginBottom:0,"> button":{padding:e.spacing(0,1)}}),wrapper:(0,r.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,r.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,r.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,r.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"})});function Kr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Kr(e,t,r[t])}))}return e}function Hr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Gr=[{value:"metrics",label:"Metric",description:"Return aggregated metrics"},{value:"profile",label:"Profile",description:"Return profile"},{value:"both",label:"Both",description:"Return both metric and profile data"}];function Yr(t){return t===e.CoreApp.Explore?Gr:Gr.filter((e=>"both"!==e.value))}function Zr({query:e,onQueryChange:r,app:n,labels:o}){var l,i;const s=(0,a.useStyles2)(Xr),c=Yr(n),u=o?o.map((e=>({label:e,value:e}))):[];let d=[`Type: ${e.queryType}`];return(null===(l=e.groupBy)||void 0===l?void 0:l.length)&&d.push(`Group by: ${e.groupBy.join(", ")}`),(null===(i=e.spanSelector)||void 0===i?void 0:i.length)&&d.push(`Span ID: ${e.spanSelector.join(", ")}`),e.maxNodes&&d.push(`Max nodes: ${e.maxNodes}`),(0,t.jsx)(fr,{gap:0,direction:"column",children:(0,t.jsx)(Ur,{title:"Options",collapsedInfo:d,children:(0,t.jsxs)("div",{className:s.body,children:[(0,t.jsx)(Wr,{label:"Query Type",children:(0,t.jsx)(a.RadioButtonGroup,{options:c,value:e.queryType,onChange:t=>r(Hr(Qr({},e),{queryType:t}))})}),(0,t.jsx)(Wr,{label:"Group by",tooltip:(0,t.jsx)(t.Fragment,{children:"Used to group the metric result by a specific label or set of labels. Does not apply to profile query."}),children:(0,t.jsx)(a.MultiSelect,{placeholder:"Label",value:e.groupBy,allowCustomValue:!0,options:u,onChange:t=>{const n=t.map((e=>e.value));r(Hr(Qr({},e),{groupBy:n}))}})}),(0,t.jsx)(Wr,{label:"Span ID",tooltip:(0,t.jsx)(t.Fragment,{children:"Sets the span ID from which to search for profiles."}),children:(0,t.jsx)(a.Input,{value:e.spanSelector||[""],type:"string",placeholder:"64f170a95f537095",onChange:t=>{r(Hr(Qr({},e),{spanSelector:""!==t.currentTarget.value?[t.currentTarget.value]:[]}))}})}),(0,t.jsx)(Wr,{label:"Max Nodes",tooltip:(0,t.jsx)(t.Fragment,{children:"Sets the maximum number of nodes to return in the flamegraph."}),children:(0,t.jsx)(a.Input,{value:e.maxNodes||"",type:"number",placeholder:"16384",onChange:t=>{let n=parseInt(t.currentTarget.value,10);n=isNaN(n)?0:n,r(Hr(Qr({},e),{maxNodes:n}))}})})]})})})}const Xr=e=>({switchLabel:(0,r.css)({color:e.colors.text.secondary,cursor:"pointer",fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.primary}}),body:(0,r.css)({display:"flex",paddingTop:e.spacing(2),gap:e.spacing(2),flexWrap:"wrap"})});function en(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function tn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){tn(e,t,r[t])}))}return e}function nn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const on=/(\w+)\s*=\s*("[^,"]+")/g,an=new e.DataSourcePlugin(ur).setConfigEditor((e=>{const{options:r,onOptionsChange:n}=e,o=(0,a.useStyles2)(Dt);return(0,t.jsxs)("div",{className:o.container,children:[(0,t.jsx)(g,{dataSourceName:"Pyroscope",docsLink:"https://grafana.com/docs/grafana/latest/datasources/pyroscope",hasRequiredFields:!1}),(0,t.jsx)(a.Divider,{spacing:4}),(0,t.jsx)(W,{config:r,onChange:n,urlPlaceholder:"http://localhost:4040"}),(0,t.jsx)(a.Divider,{spacing:4}),(0,t.jsx)(et,It({},pt({config:r,onChange:n}))),(0,t.jsx)(a.Divider,{spacing:4}),(0,t.jsx)(F,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!1,children:(0,t.jsxs)(a.Stack,{gap:5,direction:"column",children:[(0,t.jsx)(Et,{config:r,onChange:n}),Tt.config.secureSocksDSProxyEnabled&&(0,t.jsx)(a.SecureSocksProxySettings,{options:r,onOptionsChange:n}),(0,t.jsx)(Y,{title:"Querying",children:(0,t.jsx)(a.LegacyForms.FormField,{label:"Minimal step",labelWidth:13,inputEl:(0,t.jsx)(a.LegacyForms.Input,{className:"width-6",value:r.jsonData.minStep,spellCheck:!1,placeholder:"15s",onChange:e=>{n(Nt(It({},r),{jsonData:Nt(It({},r.jsonData),{minStep:e.currentTarget.value})}))},validationEvents:{[a.EventsWithValidation.onBlur]:[(0,a.regexValidation)(/^$|^\d+(ms|[Mwdhmsy])$/,"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s")]}}),tooltip:"Minimal step used for metric query. Should be the same or higher as the scrape interval setting in the Pyroscope database."})})]})})]})})).setQueryEditor((function(e){const{onChange:r,onRunQuery:o,datasource:l,query:i,range:s,app:c}=e,u=function(e,t){const r=(0,n.useRef)(e);r.current=e;const o=(0,kt.debounce)((e=>{t&&t(nn(rn({},r.current),{labelSelector:e}))}),200);return(0,n.useCallback)((e=>{o(e)}),[o])}(i,r),d=Wt(l,s),{labels:p,getLabelValues:f}=function(e,t,r){const o={to:1e4*Math.ceil(((null==e?void 0:e.to.valueOf())||0)/1e4),from:1e4*Math.floor(((null==e?void 0:e.from.valueOf())||0)/1e4)},a=(e,t,r)=>{let n,o=[`__profile_type__="${t}"`];for(;null!==(n=on.exec(e));)if(n[1]&&n[2]){if(n[1]===r)continue;o.push(`${n[1]}=${n[2]}`)}return`{${o.join(",")}}`},[l,i]=(0,n.useState)((()=>[""]));(0,n.useEffect)((()=>{const e=(n=function*(){const e=yield t.getLabelNames(a(r.labelSelector,r.profileTypeId,""),o.from,o.to);i(e)},l=function(){var e=this,t=arguments;return new Promise((function(r,o){var a=n.apply(e,t);function l(e){en(a,r,o,l,i,"next",e)}function i(e){en(a,r,o,l,i,"throw",e)}l(void 0)}))},function(){return l.apply(this,arguments)});var n,l;e()}),[r,o.from,o.to,t,i]);return{labels:l,getLabelValues:(0,n.useCallback)((e=>{const n=a(r.labelSelector,r.profileTypeId,e);return t.getLabelValues(n,e,o.from,o.to)}),[t,r.labelSelector,r.profileTypeId,o.to,o.from])}}(s,l,i);!function(e,t,r,o){(0,n.useEffect)((()=>{if(!t)return;const n=pr(e,o);e.profileTypeId||(n.profileTypeId=function(e){var t;const r=e.filter((e=>e.id.indexOf("cpu")>=0));if(r.length){const e=r.find((e=>-1===e.id.indexOf("samples")));return e?e.id:r[0].id}return(null===(t=e[0])||void 0===t?void 0:t.id)||""}(t)),Lt()(e,n)||r(n)}),[o,e,t,r])}(i,d,r,c);let b=(0,t.jsx)(a.LoadingPlaceholder,{text:"Loading"});return d&&void 0!==i.profileTypeId&&(b=(0,t.jsx)(_t,{placeholder:0===d.length?"No profile types found":"Select profile type",profileTypes:d,initialProfileTypeId:i.profileTypeId,onChange:e=>{r(nn(rn({},i),{profileTypeId:e}))}})),(0,t.jsxs)(vr,{children:[(0,t.jsxs)(yr,{stackProps:{wrap:!1,gap:1},children:[b,(0,t.jsx)(Fr,{value:i.labelSelector,onChange:u,onRunQuery:function(e){r(nn(rn({},i),{labelSelector:e})),o()},labels:p,getLabelValues:f})]}),(0,t.jsx)(yr,{children:(0,t.jsx)(Zr,{query:i,onQueryChange:e.onChange,app:e.app,labels:p})})]})}))})(),d})()));
//# sourceMappingURL=module.js.map